{"version":3,"sources":["../js/main.js"],"names":["window","$window","$","LANGUAGE_CHANGE_EVENT","UI_READY_EVENT","CONNECTED_STATE_CHANGE_EVENT","IS_BROWSER","g_initObj","Cookies","uriHash","location","hash","length","JSON","parse","decodeURIComponent","slice","Config","ClientVersion","Language","Banner","InfoURL","NewVersionEmail","NewVersionURL","FaqURL","DataCollectionInfoURL","DpiScaling","Debug","stringify","AvailableEgressRegions","console","log","overallInit","compareIEVersion","remove","attr","on","updateLogoConnectState","click","e","preventDefault","HtmlCtrlInterface_BannerClick","target","data","switchToTab","updateLinks","nextTickFn","defaultLang","siteLangs","currentLang","i18n","lng","replaceLang","_","includes","replaceFn","match","p1","p2","url","replace","regex","text","lastWindowHeight","height","lastWindowWidth","width","smartresize","nextTick","resizeContent","initScrollFix","setTimeout","HtmlCtrlInterface_AppReady","DEBUG_LOG","updateDpiScaling","fillHeight","innerHeight","position","top","footerHeight","outerHeight","parentsUntil","add","siblings","css","trigger","doMatchHeight","doMatchWidth","g_isRTL","outerWidth","dpiScaling","andResizeContent","ltrTransformOrigin","ltrBottomRightTransformOrigin","rtlTransformOrigin","rtlBottomRightTransformOrigin","getIEVersion","transformOrigin","bottomRightTransformOrigin","toFixed","defaultLeftMargin","scaledLeftMargin","each","basePosition","left","scroll","scrollTop","newSrc","stoppedSrc","connectedSrc","g_lastState","prop","g_connectingTooLongTimeout","connectionInit","connectToggleSetup","egressRegionComboSetup","hasClass","resizeConnectContent","textfill","maxFontPixels","parentWidth","parent","innerWidth","parseFloat","right","buttonConnectState","parents","HtmlCtrlInterface_StartTunnel","HtmlCtrlInterface_StopTunnel","updateConnectToggle","toggleClass","cycleToggleClass","updateConnectAttemptTooLong","clearTimeout","connectAttemptTooLongReset","connectAttemptTooLong","addClass","removeClass","elem","cls","untilStateChangeFrom","cycleToggleClass_inner","html","egressRegionComboSetup_EgressRegionCombo_click","region","refreshSettings","EgressRegion","applySettings","egressRegionComboSetup_EgressRegion_change","$activeItem","$regionItems","i","$regionItem","eq","hidden","active","find","showSettingsSection","SETTING_CHANGED_EVENT","BEST_REGION_VALUE","settingsInit","Settings","SplitTunnel","DisableTimeouts","VPN","LocalHttpProxyPort","LocalSocksProxyPort","SkipUpstreamProxy","UpstreamProxyHostname","UpstreamProxyPort","UpstreamProxyUsername","UpstreamProxyPassword","UpstreamProxyDomain","SystrayMinimize","DisableDisallowedTrafficAlert","defaults","onSettingChanged","onSettingsReset","onSettingsApply","onSettingsTabShown","is","onSettingsTabHiding","headingSelector","id","$expandIcon","blur","systrayMinimizeSetup","disableDisallowedTrafficSetup","splitTunnelSetup","disableTimeoutsSetup","egressRegionSetup","localProxySetup","upstreamProxySetup","vpnModeSetup","updateAvailableEgressRegions","one","enableSettingsApplyButton","getSettingsApplyButtonEnabled","$modal","modal","show","backdrop","off","tab","showSettingsErrorModal","settingsValues","getSettingsTabValues","settingsChanged","settingsObjectChanged","newSettings","key","keys","enable","$applyButton","currentlyEnabled","removeAttr","drawAttentionToButton","HtmlCtrlInterface_SaveSettings","forceCurrent","fullNewSettings","extend","fillSettingsValues","forceEgressRegionValid","obj","isUndefined","vpnModeUpdate","val","localProxyValid","skipUpstreamProxyUpdate","upstreamProxyValid","ignoreDisabled","valid","egressRegionValid","egressRegion","returnValue","validatePort","showNoticeModal","showSettingErrorSection","change","extraArgs","$currRegionElem","updateErrorAlert","forceValid","regions","getCookie","elemRegion","event","delay","bind","httpPort","socksPort","unique","localProxyPortConflictNotice","noticeType","bodyKey","skip","needHostname","Boolean","needUsername","portOK","skipUpstreamProxy","g_upstreamProxyErrorNoticeTimer","upstreamProxyErrorNotice","errorMessage","vpn","psiCashUIUpdater","intVal","parseInt","isNaN","toString","section","focusElem","onTabShown","collapse","not","scrollTo","duration","offset","onAfter","sendFeedback","smileyResponses","push","title","question","answer","fields","responses","feedback","email","sendDiagnosticInfo","HtmlCtrlInterface_SendFeedback","displayCornerAlert","showDebugLogsClicked","addLog","loadTemplate","timestamp","Date","toLocaleTimeString","message","priority","prepend","priorities","MAX_LOGS_PER_PRIORITY","debugLogHelper","Array","prototype","call","arguments","DEBUG_WARN","warn","consoleLogger","args","msg","isString","logger","apply","RTL_LOCALES","fallbackLanguage","lang","init","fallbackLng","resStore","PSIPHON","LOCALES","switchLocale","populateLocales","g_languageSuccessAlertShown","locale","initial","setLng","setCookie","rtl","contains","ltrClasses","rtlClasses","translation","en","appBackendStringTable","hasOwnProperty","startsWith","t","HtmlCtrlInterface_AddStringTableItem","localePriorityGuide","locales","map","sort","a","b","localePriority_a","indexOf","localePriority_b","$localeListElem","localeCode","localeName","name","append","PsiCashEventTypeEnum","REFRESH","NEW_PURCHASE","INIT_DONE","LOGIN","LOGOUT","PsiCashServerResponseStatus","Invalid","Success","ExistingTransaction","InsufficientBalance","TransactionAmountMismatch","TransactionTypeNotFound","InvalidTokens","InvalidCredentials","BadRequest","ServerError","PsiCashCommandEnum","PURCHASE","PsiCashCommandBase","command","randomID","PsiCashCommandRefresh","reason","create","constructor","PsiCashCommandPurchase","transactionClass","distinguisher","expectedPrice","PsiCashCommandLogin","username","password","PsiCashCommandLogout","PsiCashMessageTypeEnum","PsiCashStore","Datastore","initDone","purchaseInProgress","uiState","psicashInit","addWindowFocusHandler","HtmlCtrlInterface_PsiCashCommand","psiCashLibraryInitDone","evt","error","recovered","set","psiCashStateInitialized","psicashData","has_tokens","is_account","PSICASH_ENABLED_COOKIE","refreshPsiCashEventHandler","g_PsiCashData","PsiCashUIState","NSF_BALANCE","uiSelector","ENOUGH_BALANCE","BUYING_BOOST","ACTIVE_BOOST","VPN_MODE_DISABLED","ACCOUNT_LOGGED_OUT","timeout","oldPsiCashData","reconnectRequired","balance","HtmlCtrlInterface_Log","purchases","newPurchase","authorization","some","p","HtmlCtrlInterface_ReconnectTunnel","veryFirstUpdate","windowHasFocus","state","purchase_prices","pp","price","millisOfSpeedBoostRemaining","localTimeExpiry","moment","isAfter","diff","Math","max","syncPsiCashUI","PsiCashBalanceChange","baselineRateLimit","threshold","loggedOut","account_username","buy_psi_url","account_signup_url","account_management_url","formatPsi","maxEnoughBalance","filter","last","boostRemainingTime","momentLocale","humanize","boostRemainingText","vpnMode","doBalanceChange","newBalance","allDoneDefer","Deferred","previousBalance","startingPoint","balanceDiff","resolve","promise","BILLION","balanceStepTime","balanceStopInterval","maxSteps","trunc","gigaBalanceDiff","balanceStepCount","min","abs","balanceStepSize","extraStepSize","sign","intermediateBalance","$visiblePsiCashInterface","$visibleBalanceElem","tickDefer","deltaDefer","when","always","finalTickStep","balanceTickInterval","clearInterval","setInterval","psiText","$deltaElem","insertAfter","animationCSSEnpoint","animationPromise","animate","easing","queue","_queue","_first","PsiCashBalanceChange_push","first","isNumber","_pop","PsiCashBalanceChange_pop","nextBalance","changePromise","shift","toLowerCase","subLocale","split","exactLocaleMatch","subLocaleMatch","momentLocales","l","buySpeedBoostClick","psicashUIWaitState","then","result","refresh","status","Error","buyPsiClick","skipAccountEncouragement","psicashAccountLogin","nanopsi","currLang","psi","floor","toLocaleString","substring","psicashAccountLoginSubmitHandler","last_tracker_merge","keyCode","psicashAccountLogout","start","messageSelector","handleDisallowedTrafficNotice","alertDisallowedTraffic","HtmlCtrlInterface_DisallowedTraffic","subscribe","boosting","appearAnimationTime","showingTime","disappearAnimationTime","toggle","complete","callback","$tab","titleKey","levelIcon","techPreambleKey","techInfoString","closedCallback","DEBUG_ASSERT","j","$elem","matchSelector","matchSelectorsToMaxHeight","$matchSelectorMatches","$elemsToChange","matchHeight","heightDiff","align","matchSelectors","$dataMatchElems","$matchMaxElems","matchSelectorMaxWidth","unshift","getNetWidth","grossWidth","ie7_10Match","ie11Match","edgeMatch","tridentMatch","msieMatch","ieVersion","navigator","userAgent","comparison","targetVersion","acceptNonIE","g_cookies","localVal","localStorage","getItem","value","setItem","HtmlCtrlInterface_SetCookies","context","nextTickFnInner","runner","hexToRgb","hex","shorthandRegex","m","r","g","exec","backgroundColor","backgroundColorRGB","shadowColor","originalBoxShadow","animationTimeSecs","check","isFunction","document","hasFocus","handler","base64","encode","random","debugInit","HtmlCtrlInterface_SetState","updateStateCombo","HtmlCtrlInterface_AddLog","regionCheckboxes","HtmlCtrlInterface_AddNotice","downstreamBytesPerSecond","Number","HtmlCtrlInterface_UpdateDpiScaling","debugRefreshPsiCashClick","makeTestRefreshMsg","HtmlCtrlInterface_PsiCashMessage","payload","debugPsiCashInitDoneClick","testInitDoneResponse","checked","msg_id","purchase","toISOString","type","makeTestRefreshPayload","undefined","isAccount","hasTokens","accountUsername","testRefreshResponse","testPurchaseResponse","resp","msgPayload","expiry","serverTimeExpiry","testAccountLoginResponse","testAccountLogoutResponse","PSIPHON_LINK_PREFIX","jsonArgs","isObject","MAX_SAFE_INTEGER","setProxyWarningTemplate","template","g_timeoutSetState","HtmlCtrlInterface_RefreshSettings","settings","success","g_PsiCashCommandIDToResolver","appURL","stringtable","item","string","sendStringTableItem","itemObj","encodeURIComponent","join","suppressHomePage","alert","settingsJSON","feedbackJSON","cookiesJSON","commandJSON","Promise","commandToTestResponse"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2015, Psiphon Inc.\n * All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\n(function(window) {\n  \"use strict\";\n  /* jshint strict:true, newcap:false */\n\n  /* GENERAL */\n\n  var $window = $(window);\n\n  // Fired on the window when the UI language changes\n  var LANGUAGE_CHANGE_EVENT = 'language-change';\n\n  // Fired on the window when HTML interface declares itself ready.\n  var UI_READY_EVENT = 'ui-ready';\n\n  // Fired on the window when the connected state changes\n  var CONNECTED_STATE_CHANGE_EVENT = 'connected-state-change';\n\n  // We often test in-browser and need to behave a bit differently\n  var IS_BROWSER = true;\n\n  // Parse whatever JSON parameters were passed by the application.\n  var g_initObj = { Cookies: {} };\n  (function() {\n    var uriHash = location.hash;\n    if (uriHash && uriHash.length > 1) {\n      g_initObj = JSON.parse(decodeURIComponent(uriHash.slice(1)));\n      IS_BROWSER = false;\n    }\n\n    // For browser debugging\n    if (IS_BROWSER) {\n      g_initObj = g_initObj || {};\n      g_initObj.Config = g_initObj.Config || {};\n      g_initObj.Config.ClientVersion = g_initObj.Config.ClientVersion || '99';\n      g_initObj.Config.Language = g_initObj.Config.Language || 'en';\n      g_initObj.Config.Banner = g_initObj.Config.Banner || 'banner.png';\n      g_initObj.Config.InfoURL =\n        g_initObj.Config.InfoURL || 'https://example.com/browser-InfoURL/index.html';\n      g_initObj.Config.NewVersionEmail =\n        g_initObj.Config.NewVersionEmail || 'browser-NewVersionEmail@example.com';\n      g_initObj.Config.NewVersionURL =\n        g_initObj.Config.NewVersionURL || 'https://example.com/browser-NewVersionURL/en/download.html#direct';\n      g_initObj.Config.FaqURL = g_initObj.Config.FaqURL || 'https://example.com/browser-FaqURL/en/faq.html';\n      g_initObj.Config.DataCollectionInfoURL =\n        g_initObj.Config.DataCollectionInfoURL || 'https://example.com/browser-DataCollectionInfoURL/en/privacy.html#information-collected';\n      g_initObj.Config.DpiScaling = 1.0;\n      g_initObj.Config.Debug = g_initObj.Config.Debug || true;\n\n      g_initObj.Cookies = JSON.stringify({\n        AvailableEgressRegions: ['US', 'GB', 'JP', 'NL', 'DE']\n      });\n\n      console.log(g_initObj);\n    }\n  })();\n\n  $(function overallInit() {\n    // Do some browser-version-dependent DOM pruning\n    if (compareIEVersion('lte', 7, false)) {\n      $('.ie7Remove').remove();\n    }\n\n    // Set the logo \"info\" link\n    $('.js-logo a').attr('href', g_initObj.Config.InfoURL).attr('title', g_initObj.Config.InfoURL);\n\n    // Update the logo when the connected state changes\n    $window.on(CONNECTED_STATE_CHANGE_EVENT, updateLogoConnectState);\n    updateLogoConnectState();\n\n    // The banner image filename is parameterized.\n    $('.banner img').attr('src', g_initObj.Config.Banner);\n    // Let the C-code decide what should be opened when the banner is clicked.\n    $('.banner a').click(function(e) {\n      e.preventDefault();\n      HtmlCtrlInterface_BannerClick();\n    });\n\n    // Some elements besides the nav tabs switch to panes. Add handlers for that.\n    // Using `data-toggle`+`data-target` isn't good enough, as it doesn't result in the\n    // nav tab being activated.\n    $('[data-tab-switch]').on('click', function(e) {\n      e.preventDefault();\n      const target = $(this).data('tab-switch');\n      switchToTab(target, null);\n    });\n\n    // Links to the download site and email address are parameterized and need to\n    // be updated when the language changes.\n    const updateLinks = nextTickFn(function updateLinks() {\n      // For some languages we alter the \"download site\" links to point directly\n      // to that language. But the site has different available languages than\n      // this application does, so we don't just do it blindly.\n      const defaultLang = 'en';\n      const siteLangs = ['fa', 'zh'];\n      const currentLang = i18n.lng();                   // en_US\n      //const currentHTMLJSlang = $('html').prop('lang'); // en-US // unused\n      const replaceLang = _.includes(siteLangs, currentLang) ? currentLang : defaultLang;\n\n      // Note that we're using the function-as-replacement form for String.replace()\n      // because we don't entirely control the content of the language names, and\n      // we don't want to run into any issues with magic values:\n      // https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/String/replace#Specifying_a_string_as_a_parameter\n\n      const replaceFn = function(match, p1, p2) {\n          return p1 + '/' + replaceLang + '/' + p2;\n        };\n\n      // This link may be to the redirect meta page (/index.html) or to a language-specific\n      // page (/en/index.html). If it's to the meta page, we won't force to English, otherwise we will.\n      // First change it to the meta page if it's not already\n      let url = g_initObj.Config.InfoURL.replace('/en/', '/');\n      // Then force the language, but not to English\n      if (replaceLang !== defaultLang) {\n        // We're using the function form of\n        url = g_initObj.Config.InfoURL.replace(/^([^?#]*)\\/(.*)$/, replaceFn);\n      }\n      $('.InfoURL').attr('href', url).attr('title', url);\n\n      const regex = /^([^?#]*)\\/en\\/(.*)$/;\n\n      url = g_initObj.Config.NewVersionURL.replace(regex, replaceFn);\n      $('.NewVersionURL').attr('href', url).attr('title', url);\n\n      url = g_initObj.Config.FaqURL.replace(regex, replaceFn);\n      $('.FaqURL').attr('href', url).attr('title', url);\n\n      url = g_initObj.Config.DataCollectionInfoURL.replace(regex, replaceFn);\n      $('.DataCollectionInfoURL').attr('href', url).attr('title', url);\n\n      // No replacement on the email address\n      $('.NewVersionEmail').attr('href', 'mailto:' + g_initObj.Config.NewVersionEmail)\n                           .text(g_initObj.Config.NewVersionEmail)\n                           .attr('title', g_initObj.Config.NewVersionEmail);\n\n      $('.ClientVersion').text(g_initObj.Config.ClientVersion);\n    });\n    $window.on(LANGUAGE_CHANGE_EVENT, updateLinks);\n    // ...and now.\n    updateLinks();\n\n    // Update the size of our tab content element when the window resizes...\n    var lastWindowHeight = $window.height();\n    var lastWindowWidth = $window.width();\n    $window.smartresize(function() {\n      // Only go through the resize logic if the window actually changed size.\n      // This helps with the constant resize events we get with IE7.\n      if (lastWindowHeight !== $window.height() ||\n          lastWindowWidth !== $window.width()) {\n        lastWindowHeight = $window.height();\n        lastWindowWidth = $window.width();\n        nextTick(resizeContent);\n      }\n    });\n    // ...and when a tab is activated...\n    $('a[data-toggle=\"tab\"]').on('shown', function() {\n      nextTick(resizeContent);\n    });\n    // ...and when the language changes...\n    $window.on(LANGUAGE_CHANGE_EVENT, nextTickFn(resizeContent));\n    // ...and now.\n    resizeContent();\n\n    // We don't want buggy scrolling behaviour (which can result from some click-drag selecting)\n    initScrollFix();\n\n    setTimeout(HtmlCtrlInterface_AppReady, 100);\n  });\n\n\n  function resizeContent() {\n    DEBUG_LOG('resizeContent called');\n\n    // Do DPI scaling\n    updateDpiScaling(g_initObj.Config.DpiScaling, false);\n\n    // We want the content part of our window to fill the window, we don't want\n    // excessive scroll bars, etc. It's difficult to do \"fill the remaining height\"\n    // with just CSS, so we're going to do some on-resize height adjustment in JS.\n    var fillHeight = $window.innerHeight() - $('.js-main-height').position().top;\n    var footerHeight = $('.footer').outerHeight();\n    $('.js-main-height').outerHeight((fillHeight - footerHeight) / g_initObj.Config.DpiScaling);\n    $('.js-main-height').parentsUntil('body').add($('.js-main-height').siblings()).css('height', '100%');\n\n    // Let the panes know that content resized\n    $('.js-main-height').trigger('resize');\n\n    doMatchHeight();\n    doMatchWidth();\n\n    // Adjust the banner to account for the logo space.\n    $('.banner').css(g_isRTL ? 'margin-right' : 'margin-left', $('.header-nav-join').outerWidth())\n                .css(!g_isRTL ? 'margin-right' : 'margin-left', 0);\n  }\n\n  function updateDpiScaling(dpiScaling, andResizeContent/*=true*/) {\n    DEBUG_LOG('updateDpiScaling: ' + dpiScaling);\n    g_initObj.Config.DpiScaling = dpiScaling;\n\n    if (compareIEVersion('lt', 9, false)) {\n      // We need IE9+ to support DPI scaling\n      return;\n    }\n\n    var ltrTransformOrigin = '0 0 0',\n        ltrBottomRightTransformOrigin = '100% 100% 0',\n        rtlTransformOrigin = '0 0 0',\n        rtlBottomRightTransformOrigin = '0 100% 0';\n\n    if (getIEVersion() === false && g_isRTL) {\n      // Non-IE in RTL need the origin on the right.\n      rtlTransformOrigin = '100% 0 0';\n    }\n\n    var transformOrigin = g_isRTL ? rtlTransformOrigin : ltrTransformOrigin,\n        bottomRightTransformOrigin = g_isRTL ? rtlBottomRightTransformOrigin : ltrBottomRightTransformOrigin;\n\n    // Set the overall body scaling\n    $('html').css({\n      'transform-origin': transformOrigin,\n      'transform': 'scale(' + dpiScaling + ')',\n      'width': (100.0 / dpiScaling).toFixed(1) + '%',\n      'height': (100.0 / dpiScaling).toFixed(1) + '%'\n    });\n\n    // For elements (like modals) outside the normal flow, additional changes are needed.\n    if (getIEVersion() !== false) {\n      // The left margin will vary depending on default value.\n      // First reset an overridden left margin\n      $('.modal').css('margin-left', '');\n      // Get the default left margin\n      var defaultLeftMargin = $('.modal').css('margin-left');\n      // Create the left margin we want, based on the default\n      var scaledLeftMargin = 'calc(' + defaultLeftMargin + ' * ' + dpiScaling + ')';\n      // Now apply the styles.\n      $('.modal').css({\n        'transform-origin': transformOrigin,\n        'transform': 'scale(' + dpiScaling + ')',\n        'margin-left': scaledLeftMargin\n      });\n    }\n\n    $('.global-alert').css({\n      'transform-origin': bottomRightTransformOrigin,\n      'transform': 'scale(' + dpiScaling + ')'\n    });\n\n    // Elements with the `affix` class are position:fixed and need to be adjusted separately\n    if (getIEVersion() !== false) {\n      // Reset previous position modification.\n      $('.affix')\n        .css({'top': '', 'left': ''})\n        .each(function() {\n          var basePosition = $(this).position();\n          $(this).css({\n            'transform-origin': transformOrigin,\n            'transform': 'scale(' + dpiScaling + ')'\n          });\n          if (basePosition.top) {\n            $(this).css({\n              'top': (basePosition.top * dpiScaling) + 'px'\n            });\n          }\n          if (basePosition.left) {\n            $(this).css({\n              'left': (basePosition.left * dpiScaling) + 'px'\n            });\n          }\n        });\n    }\n\n    if (andResizeContent !== false) {\n      // Need to resize everything.\n      nextTick(resizeContent);\n    }\n  }\n\n  // Ensures that elements that should not be scrolled are not scrolled.\n  // This should only be called once.\n  function initScrollFix() {\n    // It would be much better to fix this correctly using CSS rather than\n    // detecting a bad state and correcting it. But until we figure that out...\n    $('body').scroll(function() {\n      $('body').scrollTop(0);\n    });\n  }\n\n\n  // Update the main connect button, as well as the connection indicator on the tab.\n  function updateLogoConnectState() {\n    var newSrc, stoppedSrc, connectedSrc;\n    stoppedSrc = $('.js-logo img').data('stopped-src');\n    connectedSrc = $('.js-logo img').data('connected-src');\n\n    if (g_lastState === 'connected') {\n      newSrc = connectedSrc;\n    }\n    else {\n      newSrc = stoppedSrc;\n    }\n\n    $('.js-logo img').prop('src', newSrc);\n  }\n\n\n  /* CONNECTION ****************************************************************/\n\n  // The current connected actual state of the application\n  var g_lastState = 'stopped';\n\n  // Used to monitor whether the current connection attempt is taking too long and\n  // so if a \"download new version\" message should be shown.\n  var g_connectingTooLongTimeout = null;\n\n  $(function connectionInit() {\n    connectToggleSetup();\n    egressRegionComboSetup();\n\n    // Update the size of our elements when the tab content element resizes...\n    $('.js-main-height').on('resize', function() {\n      // Only if this tab is active\n      if ($('#connection-pane').hasClass('active')) {\n        nextTick(resizeConnectContent);\n      }\n    });\n    // ...and when the tab is activated...\n    $('a[href=\"#connection-pane\"][data-toggle=\"tab\"]').on('shown', function() {\n      nextTick(resizeConnectContent);\n    });\n    // ...and now.\n    resizeConnectContent();\n  });\n\n  function resizeConnectContent() {\n    // Resize the text in the button\n    $('.textfill-container').textfill({ maxFontPixels: -1 });\n\n    // Set the outer connect button div to the correct height\n    $('#connect-toggle').height($('#connect-toggle > *').outerHeight());\n\n    // Center the connect button div\n    var parentWidth = $('#connect-toggle').parent().innerWidth() -\n                        (parseFloat($('#connect-toggle').parent().css('padding-left')) || 0) -\n                        (parseFloat($('#connect-toggle').parent().css('padding-right')) || 0);\n    if (g_isRTL) {\n      $('#connect-toggle').css({\n        right: ((parentWidth - $('#connect-toggle').outerWidth()) / 2.0)+'px',\n        left: ''\n      });\n    }\n    else {\n      $('#connect-toggle').css({\n        left: ((parentWidth - $('#connect-toggle').outerWidth()) / 2.0)+'px',\n        right: ''\n      });\n    }\n  }\n\n  function connectToggleSetup() {\n    $('#connect-toggle a').click(function(e) {\n      e.preventDefault();\n      var buttonConnectState = $(this).parents('.connect-toggle-content').data('connect-state');\n      if (buttonConnectState === 'stopped') {\n        HtmlCtrlInterface_StartTunnel();\n      }\n      else if (buttonConnectState === 'starting' || buttonConnectState === 'connected') {\n        HtmlCtrlInterface_StopTunnel();\n      }\n      // the stopping button is disabled\n    });\n    updateConnectToggle();\n\n    $('.textfill-container').textfill({ maxFontPixels: -1 });\n\n    // Update the button when the back-end tells us the state has changed.\n    $window.on(CONNECTED_STATE_CHANGE_EVENT, nextTickFn(updateConnectToggle));\n  }\n\n  // Update the main connect button, as well as the connection indicator on the tab.\n  function updateConnectToggle() {\n    $('.connect-toggle-content').each(function() {\n      $(this).toggleClass('z-behind', $(this).data('connect-state') !== g_lastState);\n    });\n\n    $('a[href=\"#connection-pane\"][data-toggle=\"tab\"] [data-connect-state]').each(function() {\n      $(this).toggleClass('z-behind', $(this).data('connect-state') !== g_lastState);\n    });\n\n    if (g_lastState === 'starting') {\n      cycleToggleClass(\n        $('.connect-toggle-content[data-connect-state=\"starting\"] .icon-spin, .connect-toggle-content[data-connect-state=\"starting\"] .state-word'),\n        'in-progress',\n        g_lastState);\n    }\n    else if (g_lastState === 'connected') {\n      // No additional work\n    }\n    else if (g_lastState === 'stopping') {\n      cycleToggleClass(\n        $('.connect-toggle-content[data-connect-state=\"stopping\"] .icon-spin, .connect-toggle-content[data-connect-state=\"stopping\"] .state-word'),\n        'in-progress',\n        g_lastState);\n    }\n    else if (g_lastState === 'stopped') {\n      // No additional work\n    }\n\n    updateConnectAttemptTooLong();\n  }\n\n  // Keeps track of how long the current connection attempt is taking and whether\n  // a message should be shown to the user indicating how to get a new version.\n  function updateConnectAttemptTooLong() {\n    if (g_lastState === 'connected' || g_lastState === 'stopped') {\n      // Clear the too-long timeout\n      if (g_connectingTooLongTimeout !== null) {\n        clearTimeout(g_connectingTooLongTimeout);\n        g_connectingTooLongTimeout = null;\n        connectAttemptTooLongReset();\n      }\n    }\n    else {\n      // Start the too-long timeout\n      if (g_connectingTooLongTimeout === null) {\n        g_connectingTooLongTimeout = setTimeout(connectAttemptTooLong, 60000);\n      }\n    }\n\n    function connectAttemptTooLong() {\n      $('.js-hide-if-long-connecting').addClass('hidden');\n      $('.js-show-if-long-connecting').removeClass('hidden');\n    }\n\n    function connectAttemptTooLongReset() {\n      $('.js-hide-if-long-connecting').removeClass('hidden');\n      $('.js-show-if-long-connecting').addClass('hidden');\n    }\n  }\n\n  function cycleToggleClass(elem, cls, untilStateChangeFrom) {\n    $(elem).toggleClass(cls, 1000, function() {\n      if (g_lastState === untilStateChangeFrom) {\n        nextTick(function cycleToggleClass_inner() {\n          cycleToggleClass(elem, cls, untilStateChangeFrom);\n        });\n      }\n    });\n  }\n\n  function egressRegionComboSetup() {\n    // Rather than duplicating the markup of the settings' egress region list,\n    // we're going to copy it now.\n    // IE7: Don't use $().clone().\n    $('#EgressRegionCombo ul').html($('ul#EgressRegion').html());\n\n    // When an item in the combo is clicked, make the settings code do the work.\n    $('#EgressRegionCombo ul a').click(function egressRegionComboSetup_EgressRegionCombo_click(e) {\n      e.preventDefault();\n      var region = $(this).parents('[data-region]').data('region');\n      if (!region) {\n        return;\n      }\n\n      refreshSettings({\n        EgressRegion: region\n      });\n\n      applySettings();\n    });\n\n    // Have the combobox track the state of the control in the settings pane.\n    $('#EgressRegion').on('change', function egressRegionComboSetup_EgressRegion_change() {\n      var $activeItem;\n      // Copy the relevant classes to the combo items from the settings items.\n      var $regionItems = $('#EgressRegion li');\n      for (var i = 0; i < $regionItems.length; i++) {\n        var $regionItem = $regionItems.eq(i);\n        var region = $regionItem.data('region');\n        var hidden = $regionItem.hasClass('hidden');\n        var active = $regionItem.hasClass('active');\n\n        $('#EgressRegionCombo li[data-region=\"' + region + '\"]')\n          .toggleClass('hidden', hidden)\n          .toggleClass('active', active);\n\n        if (active) {\n          $activeItem = $regionItem;\n        }\n      }\n\n      // Update the button\n      if ($activeItem) {\n        $('#EgressRegionCombo .btn span.flag')\n          .attr('data-i18n', $activeItem.find('a').data('i18n'))\n          .attr('class', $activeItem.find('a').attr('class'))\n          .text($activeItem.find('a').text());\n      }\n    });\n\n    // If the label is clicked, jump to the Egress Region settings section\n    $('.egress-region-combo-container label a').click(function(e) {\n      e.preventDefault();\n      showSettingsSection('#settings-accordion-egress-region');\n      return false;\n    });\n  }\n\n\n  /* SETTINGS ******************************************************************/\n\n  // Event fired on #settings-pane when a setting is changed.\n  var SETTING_CHANGED_EVENT = 'setting-changed';\n\n  var BEST_REGION_VALUE = 'BEST';\n\n  $(function settingsInit() {\n    // This is merely to help with testing\n    if (!g_initObj.Settings)\n    {\n      g_initObj.Settings = {\n        SplitTunnel: 0,\n        DisableTimeouts: 0,\n        VPN: 0,\n        LocalHttpProxyPort: 7771,\n        LocalSocksProxyPort: 7770,\n        SkipUpstreamProxy: 1,\n        UpstreamProxyHostname: 'upstreamhost',\n        UpstreamProxyPort: 234,\n        UpstreamProxyUsername: 'user',\n        UpstreamProxyPassword: 'password',\n        UpstreamProxyDomain: 'domain',\n        EgressRegion: 'GB',\n        SystrayMinimize: 0,\n        DisableDisallowedTrafficAlert: 0,\n        defaults: {\n          SplitTunnel: 0,\n          DisableTimeouts: 0,\n          VPN: 0,\n          LocalHttpProxyPort: '',\n          LocalSocksProxyPort: '',\n          SkipUpstreamProxy: 0,\n          UpstreamProxyHostname: '',\n          UpstreamProxyPort: '',\n          UpstreamProxyUsername: '',\n          UpstreamProxyPassword: '',\n          UpstreamProxyDomain: '',\n          EgressRegion: '',\n          SystrayMinimize: 0,\n          DisableDisallowedTrafficAlert: 0\n        }\n      };\n    }\n\n    // Event handlers\n    $('#settings-pane').on(SETTING_CHANGED_EVENT, onSettingChanged);\n    $('.settings-buttons .reset-settings').click(onSettingsReset);\n    $('.settings-buttons .apply-settings').click(onSettingsApply);\n    $('a[href=\"#settings-pane\"][data-toggle=\"tab\"]').on('shown', onSettingsTabShown);\n    $('a[data-toggle=\"tab\"]').on('show', function(e) {\n      if ($('#settings-tab').hasClass('active') &&    // we were active\n          !$(this).parent().is($('#settings-tab'))) { // we won't be active\n        onSettingsTabHiding(e);\n      }\n    });\n\n    // Change the accordion heading icon on expand/collapse\n    $('.js-accordion-body')\n      .on('show', function() {\n        var headingSelector = '.accordion-toggle[href=\"#' + this.id + '\"]';\n        $(headingSelector).addClass('accordion-expanded');\n        var $expandIcon = $(headingSelector).find('.accordion-expand-icon');\n        $expandIcon.removeClass($expandIcon.data('icon-closed'))\n                   .addClass($expandIcon.data('icon-opened'));\n\n        // Remove focus from the heading to clear the text-decoration. (It's too\n        // ham-fisted to do it in CSS.)\n        $(headingSelector).blur();\n      })\n      .on('hide', function() {\n        var headingSelector = '.accordion-toggle[href=\"#' + this.id + '\"]';\n        $(headingSelector).removeClass('accordion-expanded');\n        var $expandIcon = $(headingSelector).find('.accordion-expand-icon');\n        $expandIcon.removeClass($expandIcon.data('icon-opened'))\n                   .addClass($expandIcon.data('icon-closed'));\n\n        // Remove focus from the heading to clear the text-decoration. (It's too\n        // ham-fisted to do it in CSS.)\n        $(headingSelector).blur();\n      });\n\n    systrayMinimizeSetup();\n    disableDisallowedTrafficSetup();\n    splitTunnelSetup();\n    disableTimeoutsSetup();\n    egressRegionSetup();\n    localProxySetup();\n    upstreamProxySetup();\n    vpnModeSetup();\n\n    updateAvailableEgressRegions(false); // don't force valid -- haven't filled in settings yet\n\n    $window.one(UI_READY_EVENT, function() {\n      // Fill in the settings. This must be done after the UI is ready, since it might\n      // show an error, requiring i18n to be initialized.\n      refreshSettings();\n    });\n  });\n\n  //\n  // Overall event handlers\n  //\n\n  // Settings tab has been navigated to and is shown\n  function onSettingsTabShown() {\n    // Reset the Apply button\n    enableSettingsApplyButton(false);\n  }\n\n  // Settings tab is showing, but is being navigated away from.\n  // Call e.preventDefault() to prevent navigation away.\n  function onSettingsTabHiding(e) {\n    // If the settings have been changed and not applied, prevent navigating away\n    // and prompt the user for how it should be resolved.\n    if (getSettingsApplyButtonEnabled()) {\n      e.preventDefault();\n\n      var $modal = $('#SettingsUnappliedChangesPrompt');\n\n      $modal.modal({\n        show: true,\n        backdrop: 'static'\n      });\n\n      // Note: If we don't first remove existing click handlers (with .off), then\n      // the handler that wasn't clicked last time will still be present.\n\n      $modal.find('.js-apply-button').off('click').one('click', function() {\n        $modal.modal('hide');\n        if (applySettings()) {\n          enableSettingsApplyButton(false);\n          $(e.target).tab('show');\n        }\n        else {\n          showSettingsErrorModal();\n        }\n      });\n\n      $modal.find('.js-discard-button').off('click').one('click', function() {\n        $modal.modal('hide');\n        refreshSettings(g_initObj.Settings);\n        enableSettingsApplyButton(false);\n        $(e.target).tab('show');\n      });\n    }\n  }\n\n  // A setting value has been changed.\n  function onSettingChanged(e, id) {\n    DEBUG_LOG('onSettingChanged: ' + id);\n\n    var settingsValues = getSettingsTabValues();\n\n    if (settingsValues === false) {\n      // Settings values are invalid\n      enableSettingsApplyButton(false);\n    }\n    else {\n      var settingsChanged = settingsObjectChanged(settingsValues);\n      enableSettingsApplyButton(settingsChanged);\n    }\n  }\n\n  // Handler for the Reset Settings button\n  function onSettingsReset(e) {\n    /*jshint validthis:true */\n\n    e.preventDefault();\n    $(this).blur();\n\n    refreshSettings(g_initObj.Settings.defaults, false);\n\n    // Force the Apply button to be enabled. Otherwise the user might be confused\n    // about how to make the Reset take effect.\n    enableSettingsApplyButton(true);\n  }\n\n  // Handler for the Apply Settings button\n  function onSettingsApply(e) {\n    /*jshint validthis:true */\n\n    e.preventDefault();\n    $(this).blur();\n\n    if (!getSettingsApplyButtonEnabled()) {\n      return;\n    }\n\n    if (applySettings()) {\n      // Reset the Apply button\n      enableSettingsApplyButton(false);\n\n      // Switch to Connection tab\n      switchToTab('#connection-tab');\n    }\n    else {\n      showSettingsErrorModal();\n    }\n  }\n\n  //\n  // General settings functions\n  //\n\n  // Returns true if newSettings differs from the current canonical settings.\n  function settingsObjectChanged(newSettings) {\n    // This does not take into account more/fewer keys in the object, since that\n    // should not happen.\n\n    var key, i;\n    var keys = _.keys(g_initObj.Settings);\n    for (i = 0; i < keys.length; i++) {\n      key = keys[i];\n      if (key === 'defaults') {\n        // The defaults object doesn't count in the comparison.\n        continue;\n      }\n\n      if (newSettings[key] !== g_initObj.Settings[key]) {\n        DEBUG_LOG('settingsObjectChanged: detected change: ' + key);\n        return true;\n      }\n    }\n\n    DEBUG_LOG('settingsObjectChanged: no change');\n    return false;\n  }\n\n  function enableSettingsApplyButton(enable) {\n    var $applyButton = $('#settings-pane .apply-settings');\n    var currentlyEnabled = getSettingsApplyButtonEnabled();\n\n    if (enable && !currentlyEnabled) {\n      $applyButton.removeClass('disabled').removeAttr('disabled');\n      drawAttentionToButton($applyButton);\n    }\n    else if (!enable && currentlyEnabled) {\n      $applyButton.addClass('disabled').attr('disabled', true);\n    }\n  }\n\n  function getSettingsApplyButtonEnabled() {\n    var $applyButton = $('#settings-pane .apply-settings');\n    return !$applyButton.hasClass('disabled');\n  }\n\n  // Save the current settings (and possibly reconnect).\n  function applySettings() {\n    var settingsValues = getSettingsTabValues();\n    if (settingsValues === false) {\n      // Settings are invalid.\n      return false;\n    }\n\n    // Update settings in the application (and trigger a reconnect, if\n    // necessary).\n    HtmlCtrlInterface_SaveSettings(JSON.stringify(settingsValues));\n\n    return true;\n  }\n\n  // Refresh the current settings. If newSettings is truthy, it will become the\n  // the new current settings, otherwise the existing current settings will be\n  // refreshed in the UI.\n  // newSettings can be a partial settings object (like, just {egressRegion: \"US\"} or whatever).\n  // If forceCurrent is true, the new settings will be become canonical (rather than just displayed).\n  function refreshSettings(newSettings, forceCurrent) {\n    var fullNewSettings = $.extend(g_initObj.Settings, newSettings || {});\n\n    if (forceCurrent) {\n      g_initObj.Settings = fullNewSettings;\n    }\n\n    fillSettingsValues(fullNewSettings);\n\n    // When the settings change, we need to check the current egress region choice.\n    forceEgressRegionValid();\n    // NOTE: If more checks like this are added, we'll need to chain them (somehow),\n    // otherwise we'll have a mess of modals.\n  }\n\n  // Fill in the settings controls with the values in `obj`.\n  function fillSettingsValues(obj) {\n    // Bit of a hack: Unhook the setting-changed event while we fill in the\n    // values, then hook it up again after.\n    $('#settings-pane').off(SETTING_CHANGED_EVENT, onSettingChanged);\n\n    if (!_.isUndefined(obj.SplitTunnel)) {\n      $('#SplitTunnel').prop('checked', !!obj.SplitTunnel);\n    }\n\n    if (!_.isUndefined(obj.DisableTimeouts)) {\n      $('#DisableTimeouts').prop('checked', !!obj.DisableTimeouts);\n    }\n\n    if (!_.isUndefined(obj.VPN)) {\n      $('#VPN').prop('checked', obj.VPN);\n    }\n    vpnModeUpdate();\n\n    if (!_.isUndefined(obj.LocalHttpProxyPort)) {\n      $('#LocalHttpProxyPort').val(obj.LocalHttpProxyPort > 0 ? obj.LocalHttpProxyPort : '');\n    }\n\n    if (!_.isUndefined(obj.LocalSocksProxyPort)) {\n      $('#LocalSocksProxyPort').val(obj.LocalSocksProxyPort > 0 ? obj.LocalSocksProxyPort : '');\n    }\n\n    localProxyValid(false);\n\n    if (!_.isUndefined(obj.UpstreamProxyHostname)) {\n      $('#UpstreamProxyHostname').val(obj.UpstreamProxyHostname);\n    }\n\n    if (!_.isUndefined(obj.UpstreamProxyPort)) {\n      $('#UpstreamProxyPort').val(obj.UpstreamProxyPort > 0 ? obj.UpstreamProxyPort : '');\n    }\n\n    if (!_.isUndefined(obj.UpstreamProxyUsername)) {\n      $('#UpstreamProxyUsername').val(obj.UpstreamProxyUsername);\n    }\n\n    if (!_.isUndefined(obj.UpstreamProxyPassword)) {\n      $('#UpstreamProxyPassword').val(obj.UpstreamProxyPassword);\n    }\n\n    if (!_.isUndefined(obj.UpstreamProxyDomain)) {\n      $('#UpstreamProxyDomain').val(obj.UpstreamProxyDomain);\n    }\n\n    if (!_.isUndefined(obj.SkipUpstreamProxy)) {\n      $('#SkipUpstreamProxy').prop('checked', obj.SkipUpstreamProxy);\n    }\n    skipUpstreamProxyUpdate();\n\n    upstreamProxyValid(false);\n\n    if (!_.isUndefined(obj.EgressRegion)) {\n      var region = obj.EgressRegion || BEST_REGION_VALUE;\n      $('#EgressRegion [data-region]').removeClass('active');\n      $('#EgressRegion').find('[data-region=\"' + region + '\"] a').trigger(\n        'click',\n        { ignoreDisabled: true });\n    }\n\n    if (!_.isUndefined(obj.SystrayMinimize)) {\n      $('#SystrayMinimize').prop('checked', !!obj.SystrayMinimize);\n    }\n\n    if (!_.isUndefined(obj.DisableDisallowedTrafficAlert)) {\n      $('#DisableDisallowedTrafficAlert').prop('checked', !!obj.DisableDisallowedTrafficAlert);\n    }\n\n    // Re-hook the setting-changed event\n    $('#settings-pane').on(SETTING_CHANGED_EVENT, onSettingChanged);\n  }\n\n  // Extracts the values current set in the tab and returns and object with them.\n  // Returns false if the settings are invalid.\n  function getSettingsTabValues() {\n    var valid = true;\n\n    valid = valid && egressRegionValid(true);\n    valid = valid && localProxyValid(true);\n    valid = valid && upstreamProxyValid(true);\n\n    if (!valid) {\n      return false;\n    }\n\n    var egressRegion = $('#EgressRegion li.active').data('region');\n\n    var returnValue = {\n      VPN: $('#VPN').prop('checked') ? 1 : 0,\n      SplitTunnel: $('#SplitTunnel').prop('checked') ? 1 : 0,\n      DisableTimeouts: $('#DisableTimeouts').prop('checked') ? 1 : 0,\n      LocalHttpProxyPort: validatePort($('#LocalHttpProxyPort').val()),\n      LocalSocksProxyPort: validatePort($('#LocalSocksProxyPort').val()),\n      UpstreamProxyHostname: $('#UpstreamProxyHostname').val(),\n      UpstreamProxyPort: validatePort($('#UpstreamProxyPort').val()),\n      UpstreamProxyUsername: $('#UpstreamProxyUsername').val(),\n      UpstreamProxyPassword: $('#UpstreamProxyPassword').val(),\n      UpstreamProxyDomain: $('#UpstreamProxyDomain').val(),\n      SkipUpstreamProxy: $('#SkipUpstreamProxy').prop('checked') ? 1 : 0,\n      EgressRegion: egressRegion === BEST_REGION_VALUE ? '' : egressRegion,\n      SystrayMinimize: $('#SystrayMinimize').prop('checked') ? 1 : 0,\n      DisableDisallowedTrafficAlert: $('#DisableDisallowedTrafficAlert').prop('checked') ? 1 : 0\n    };\n\n    return returnValue;\n  }\n\n  function showSettingsErrorModal() {\n    showNoticeModal(\n      'settings#error-modal#title',\n      'settings#error-modal#body',\n      'error',\n      null, null,\n      function() {\n        showSettingErrorSection();\n      }\n    );\n  }\n\n  function showSettingErrorSection() {\n    showSettingsSection(\n      $('#settings-accordion .collapse .error').parents('.collapse').eq(0),\n      $('#settings-pane .error input').eq(0).trigger('focus'));\n  }\n\n  //\n  // Systray Minimize\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function systrayMinimizeSetup() {\n    $('#SystrayMinimize').change(function() {\n      // Tell the settings pane a change was made.\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n    });\n  }\n\n  //\n  // Disable disallowed traffic alert\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function disableDisallowedTrafficSetup() {\n    $('#DisableDisallowedTrafficAlert').change(function() {\n      // Tell the settings pane a change was made.\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n    });\n  }\n\n  //\n  // Split Tunnel\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function splitTunnelSetup() {\n    $('#SplitTunnel').change(function() {\n      // Tell the settings pane a change was made.\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n    });\n  }\n\n  //\n  // Disable Timeouts\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function disableTimeoutsSetup() {\n    $('#DisableTimeouts').change(function() {\n      // Tell the settings pane a change was made.\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n    });\n  }\n\n  //\n  // Egress Region (Psiphon Server Region)\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function egressRegionSetup() {\n    // Handle changes to the Egress Region\n    $('#EgressRegion a').click(function(e, extraArgs) {\n      e.preventDefault();\n\n      // Do nothing if we're disabled, unless we're forcing a disabled bypass\n      if ($('#EgressRegion').hasClass('disabled') &&\n          (!extraArgs || !extraArgs.ignoreDisabled)) {\n        $(this).blur();\n        return;\n      }\n\n      // Check if this target item is already active. Return if so.\n      if ($(this).parents('[data-region]').hasClass('active')) {\n        return;\n      }\n\n      $('#EgressRegion [data-region]').removeClass('active');\n      $(this).parents('[data-region]').addClass('active');\n      egressRegionValid(false);\n\n      // This event helps the combobox on the connect pane stay in sync.\n      $('#EgressRegion').trigger('change');\n\n      // Tell the settings pane a change was made.\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, 'EgressRegion');\n    });\n  }\n\n  // Returns true if the egress region value is valid, otherwise false.\n  // Shows/hides an error message as appropriate.\n  function egressRegionValid(/*finalCheck*/) {\n    var $currRegionElem = $('#EgressRegion li.active');\n\n    // Check to make sure the currently selected egress region is one of the\n    // available regions.\n    var valid = $currRegionElem.length > 0 && !$currRegionElem.hasClass('hidden');\n\n    $('#EgressRegion').toggleClass('error', !valid);\n    $('#settings-accordion-egress-region .js-egress-region-invalid').toggleClass('hidden', valid);\n\n    updateErrorAlert();\n    return valid;\n  }\n\n  // Check to make sure the currently selected egress region is one of the available\n  // regions. If not, inform the user and get them to pick another.\n  // A mismatch may occur either as a result of a change in the available egress\n  // regions, or a change in the current selection (i.e., a settings change).\n  function forceEgressRegionValid() {\n    if (egressRegionValid()) {\n      // Valid, nothing to do\n      return;\n    }\n\n    // Put up the modal message\n    showNoticeModal(\n      'settings#egress-region#error-modal-title',\n      'settings#egress-region#error-modal-body-http',\n      'warning',\n      null, null, null);\n\n    showSettingsSection('#settings-accordion-egress-region');\n  }\n\n  // Update the egress region options we show in the UI.\n  // If `forceValid` is true, then if the currently selected region is no longer\n  // available, the user will be prompted to pick a new one.\n  function updateAvailableEgressRegions(forceValid) {\n    var regions = getCookie('AvailableEgressRegions');\n    // On first run there will be no such cookie.\n    regions = regions || [];\n\n    $('#EgressRegion li').each(function() {\n      var elemRegion = $(this).data('region');\n\n      // If no region, this is a divider\n      if (!elemRegion) {\n        return;\n      }\n\n      if (_.includes(regions, elemRegion) || elemRegion === BEST_REGION_VALUE) {\n        $(this).removeClass('hidden');\n      }\n      else {\n        $(this).addClass('hidden');\n      }\n    });\n\n    if (forceValid) {\n      forceEgressRegionValid();\n    }\n\n    $('#EgressRegion').trigger('change');\n  }\n\n  //\n  // Local Proxy Ports\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function localProxySetup() {\n    // Handle change events\n    $('#LocalHttpProxyPort, #LocalSocksProxyPort').on(\n        'keyup keydown keypress change blur',\n        function(event) {\n          // We need to delay this processing so that the change to the text has\n          // had a chance to take effect. Otherwise this.val() will return the old\n          // value.\n          _.delay(_.bind(function() {\n            // Tell the settings pane a change was made.\n            $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n\n            // Check for validity.\n            localProxyValid(false);\n          }, this, event), 100);\n        });\n  }\n\n  // Returns true if the local proxy values are valid, otherwise false.\n  // Shows/hides an error message as appropriate.\n  function localProxyValid(/*finalCheck*/) {\n    // This check always shows an error while the user is typing, so finalCheck is ignored.\n\n    var httpPort = validatePort($('#LocalHttpProxyPort').val());\n    var socksPort = validatePort($('#LocalSocksProxyPort').val());\n    var unique = (httpPort !== socksPort) || (httpPort === 0) || (socksPort === 0);\n\n    if (httpPort !== false && unique) {\n      // Remove HTTP port error state\n      $('#LocalHttpProxyPort').parents('.control-group').removeClass('error');\n    }\n\n    if (socksPort !== false && unique) {\n      // Remove SOCKS port error state\n      $('#LocalSocksProxyPort').parents('.control-group').removeClass('error');\n    }\n\n    if (httpPort !== false) {\n      // Remove port value error message\n      $('.help-inline.js-LocalHttpProxyPort').addClass('hidden');\n    }\n\n    if (socksPort !== false) {\n      // Remove port value error message\n      $('.help-inline.js-LocalSocksProxyPort').addClass('hidden');\n    }\n\n    if (unique) {\n      // Remove uniqueness error message\n      $('.help-block.local-port-unique').addClass('hidden');\n    }\n\n    if (httpPort === false) {\n      // Add HTTP port error state\n      $('#LocalHttpProxyPort').parents('.control-group').addClass('error');\n      $('.help-inline.js-LocalHttpProxyPort').removeClass('hidden');\n    }\n\n    if (socksPort === false) {\n      // Add SOCKS port error state\n      $('#LocalSocksProxyPort').parents('.control-group').addClass('error');\n      $('.help-inline.js-LocalSocksProxyPort').removeClass('hidden');\n    }\n\n    if (!unique) {\n      // Add error state on both ports\n      $('#LocalHttpProxyPort, #LocalSocksProxyPort')\n        .parents('.control-group').addClass('error');\n      // Show error message\n      $('.help-block.local-port-unique').removeClass('hidden');\n    }\n\n    updateErrorAlert();\n\n    return httpPort !== false && socksPort !== false && unique;\n  }\n\n  // Show an error modal telling the user there is a local port conflict problem\n  function localProxyPortConflictNotice(noticeType) {\n    // Show the appropriate message depending on the error\n    var bodyKey = noticeType === 'HttpProxyPortInUse' ?\n                  'settings#local-proxy-ports#error-modal-body-http' :\n                  'settings#local-proxy-ports#error-modal-body-socks';\n\n    showNoticeModal(\n      'settings#local-proxy-ports#error-modal-title',\n      bodyKey,\n      'error',\n      null, null, null);\n\n    // Switch to the appropriate settings section\n    showSettingsSection(\n      '#settings-accordion-local-proxy-ports',\n      noticeType === 'HttpProxyPortInUse' ? '#LocalHttpProxyPort' : '#LocalSocksProxyPort');\n  }\n\n  //\n  // Upstream Proxy\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function upstreamProxySetup() {\n    // Handle change events\n    $('#UpstreamProxyHostname, #UpstreamProxyPort, #UpstreamProxyUsername, #UpstreamProxyPassword, #UpstreamProxyDomain').on(\n        'keyup keydown keypress change blur',\n        function(event) {\n          // We need to delay this processing so that the change to the text has\n          // had a chance to take effect. Otherwise this.val() will return the old\n          // value.\n          _.delay(_.bind(function() {\n            // Tell the settings pane a change was made.\n            $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n\n            // Check for validity.\n            upstreamProxyValid(false);\n          }, this, event), 100);\n        });\n\n    // Add the \"skip\" checkbox handler.\n    $('#SkipUpstreamProxy').change(function() {\n      // Trigger overall change event\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n\n      skipUpstreamProxyUpdate();\n    });\n  }\n\n  // Returns true if the upstream proxy values are valid, otherwise false.\n  // Shows/hides an error message as appropriate.\n  function upstreamProxyValid(/*finalCheck*/) {\n    // If any field other than hostname is set, then hostname must be set,\n    // AND if port is set, it must be an integer in the range 1-65535,\n    // AND if either of domain or password is set, then username must be as well.\n    // Unless 'skip' is checked.\n\n    let skip = $('#SkipUpstreamProxy').prop('checked');\n\n    let needHostname =\n      Boolean($('#UpstreamProxyPort').val()) ||\n      Boolean($('#UpstreamProxyUsername').val()) ||\n      Boolean($('#UpstreamProxyPassword').val()) ||\n      Boolean($('#UpstreamProxyDomain').val());\n\n    let needUsername =\n      Boolean($('#UpstreamProxyPassword').val()) ||\n      Boolean($('#UpstreamProxyDomain').val());\n\n    let valid = true;\n\n    let portOK = validatePort($('#UpstreamProxyPort').val()) !== false;\n    if (skip || portOK) {\n      // Hide the port-specific message\n      $('.help-inline.js-UpstreamProxyPort').addClass('hidden')\n        .parents('.control-group').removeClass('error');\n    } else {\n      valid = false;\n      // Port value bad. Show error while typing\n      $('.help-inline.js-UpstreamProxyPort').removeClass('hidden')\n        .parents('.control-group').addClass('error');\n    }\n\n    if (skip || !needHostname || Boolean($('#UpstreamProxyHostname').val())) {\n      // Hide the \"hostname required\" message\n      $('.upstream-proxy-set-hostname-error-msg').addClass('hidden');\n      // And remove error state from the control\n      $('#UpstreamProxyHostname')\n        .parents('.control-group').removeClass('error');\n    }\n    else {\n      valid = false;\n      // Show the \"hostname required\" message\n      $('.upstream-proxy-set-hostname-error-msg').removeClass('hidden');\n      // And add error state to the control\n      $('#UpstreamProxyHostname')\n        .parents('.control-group').addClass('error');\n    }\n\n    if (skip || !needUsername || Boolean($('#UpstreamProxyUsername').val())) {\n      // Hide the \"username required\" message\n      $('.upstream-proxy-set-username-error-msg').addClass('hidden');\n      // And remove error state from the control\n      $('#UpstreamProxyUsername')\n        .parents('.control-group').removeClass('error');\n    }\n    else {\n      valid = false;\n      // Show the \"username required\" message\n      $('.upstream-proxy-set-username-error-msg').removeClass('hidden');\n      // And add error state to the control\n      $('#UpstreamProxyUsername')\n        .parents('.control-group').addClass('error');\n    }\n\n    updateErrorAlert();\n\n    return valid;\n  }\n\n  // The other upstream proxy settings should be disabled if skip-upstream-proxy\n  // is set.\n  function skipUpstreamProxyUpdate() {\n    var skipUpstreamProxy = $('#SkipUpstreamProxy').prop('checked');\n    $('.js-skip-upstream-proxy-incompatible input').prop('disabled', skipUpstreamProxy);\n    $('.js-skip-upstream-proxy-incompatible').toggleClass('disabled-text', skipUpstreamProxy);\n  }\n\n  // The occurrence of an upstream proxy error might mean that a tunnel cannot\n  // ever be established, but not necessarily -- it might just be, for example,\n  // that the upstream proxy doesn't allow the port needed for one of our\n  // servers, but not all of them.\n  // So instead of showing an error immediately, we'll remember that the upstream\n  // proxy error occurred, wait a while to see if we connect successfully, and\n  // show it if we haven't connected.\n  // Potential enhancement: If the error modal is showing and the connection\n  // succeeds, dismiss the modal. This would be good behaviour, but probably too\n  // fringe to be worthwhile.\n  var g_upstreamProxyErrorNoticeTimer = null;\n\n  // When the connected state changes, we clear the timer.\n  $window.on(CONNECTED_STATE_CHANGE_EVENT, function() {\n    if (g_upstreamProxyErrorNoticeTimer) {\n      clearTimeout(g_upstreamProxyErrorNoticeTimer);\n      g_upstreamProxyErrorNoticeTimer = null;\n    }\n  });\n\n  function upstreamProxyErrorNotice(errorMessage) {\n    if (g_upstreamProxyErrorNoticeTimer) {\n      // We've already received an upstream proxy error and we're waiting to show it.\n      return;\n    }\n\n    // This is the first upstream proxy error we've received, so start waiting to\n    // show a message for it.\n    g_upstreamProxyErrorNoticeTimer = setTimeout(function() {\n      // It can happen that we receive a notice about an upstream error *after*\n      // we have successfully connected -- it will have been received from one\n      // of the parallel unsuccessful connection attempts. We should not show\n      // such an error. So, as a general statement: Do not show upstream errors\n      // if we're already successfully connected.\n      if (g_lastState === 'connected') {\n        if (g_upstreamProxyErrorNoticeTimer) {\n          g_upstreamProxyErrorNoticeTimer = null;\n        }\n        return;\n      }\n\n      // There are two slightly different error messages shown depending on whether\n      // there is an upstream proxy explicitly configured, or it's the default\n      // empty value, which means the pre-existing system proxy will be used.\n      var bodyKey = 'settings#upstream-proxy#error-modal-body-default';\n      if (g_initObj.Settings.UpstreamProxyHostname) {\n        bodyKey = 'settings#upstream-proxy#error-modal-body-configured';\n      }\n\n      showNoticeModal(\n        'settings#upstream-proxy#error-modal-title',\n        bodyKey,\n        'error',\n        'general#notice-modal-tech-preamble',\n        errorMessage,\n        function() {\n          $('#UpstreamProxyHostname').trigger('focus');\n        });\n\n      // Switch to the appropriate settings section\n      showSettingsSection('#settings-accordion-upstream-proxy');\n\n      // We are not going to set the timer to null here. We only want the error\n      // to show once per connection attempt sequence. It will be cleared when\n      // the client transistions to 'stopped' or 'connected'.\n    }, 60000);\n  }\n\n  //\n  // VPN Mode (Transport Mode)\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function vpnModeSetup() {\n    // Some fields are disabled in VPN mode\n    $('#VPN').change(function() {\n      // Tell the settings pane a change was made.\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n\n      vpnModeUpdate();\n    });\n  }\n\n  // Some of the settings are incompatible with VPN mode. We'll modify the\n  // display depending on the choice of VPN mode.\n  function vpnModeUpdate() {\n    var vpn = $('#VPN').prop('checked');\n    $('input.vpn-incompatible, .vpn-incompatible input, '+\n      'select.vpn-incompatible, .vpn-incompatible select, .vpn-incompatible .dropdown-menu')\n        .prop('disabled', vpn).toggleClass('disabled', vpn);\n    $('.vpn-incompatible-msg').toggleClass('hidden', !vpn);\n    $('.vpn-incompatible').toggleClass('disabled-text', vpn);\n    $('.js-vpn-incompatible-hide').toggleClass('hidden', vpn);\n\n    // The VPN mode also has implications for the PsiCash UI, so update it as well.\n    psiCashUIUpdater();\n  }\n\n  //\n  // Helpers\n  //\n\n  // Show/hide the error alert depending on whether we have an erroneous field\n  function updateErrorAlert() {\n    $('#settings-pane .value-error-alert').toggleClass(\n      'invisible z-behind', $('#settings-pane .control-group.error').length === 0);\n  }\n\n  // Returns the numeric port if valid, otherwise false. Note that 0 is a valid\n  // return value, and falsy, so use `=== false`.\n  function validatePort(val) {\n    if (val.length === 0) {\n      return 0;\n    }\n\n    const intVal = parseInt(val);\n    if (isNaN(intVal) || intVal < 1 || intVal > 65535) {\n      return false;\n    }\n\n    if (intVal.toString() !== val) {\n      // There were extra characters at the end of the string that didn't get converted\n      // into the int.\n      return false;\n    }\n\n    return intVal;\n  }\n\n  // Show the Settings tab and expand the target section.\n  // If focusElem is optional; if set, focus will be put in that element.\n  function showSettingsSection(section, focusElem) {\n    // We can only expand the section after the tab is shown\n    function onTabShown() {\n      // Hack: The collapse-show doesn't seem to work unless we wait a bit\n      setTimeout(function() {\n        // Expand the section\n        $(section).collapse('show');\n\n        // Collapse any other sections\n        $('#settings-accordion .in.collapse').not(section).collapse('hide');\n\n        // Scroll to the section, after allowing the section to expand\n        setTimeout(function() {\n          $('#settings-pane').scrollTo(\n            $(section).parents('.accordion-group').eq(0),\n            {\n              duration: 500, // animation time\n              offset: -50,   // leave some space for the alert\n              onAfter: function() {\n                if (focusElem) {\n                  $(focusElem).eq(0).trigger('focus');\n                }\n              }\n            });\n        }, 200);\n      }, 500);\n    }\n\n    // Make sure the settings tab is showing.\n    switchToTab('#settings-tab', onTabShown);\n  }\n\n\n  /* FEEDBACK ******************************************************************/\n\n  $(function() {\n    // Add click listener to the happy/sad choices\n    $('.feedback-smiley .feedback-choice').click(function(e) {\n      e.preventDefault();\n      $('.feedback-smiley .feedback-choice').removeClass('selected');\n      $(this).addClass('selected');\n    });\n\n    $('#feedback-submit').click(function(e) {\n      e.preventDefault();\n      sendFeedback();\n    });\n\n    // The sponsor-specific links in the text will be set correctly elsewhere.\n  });\n\n  function sendFeedback() {\n    var smileyResponses = [];\n    $('.feedback-choice.selected').each(function() {\n      smileyResponses.push({\n        title: $(this).data('feedback-choice-title'),\n        question: $(this).data('feedback-choice-hash'),\n        answer: $(this).data('feedback-choice-value')\n      });\n    });\n\n    var fields = {\n      responses: smileyResponses,\n      feedback: $('#feedback-comments').val(),\n      email: $('#feedback-email').val(),\n      sendDiagnosticInfo: !!$('#feedback-send-diagnostic').prop('checked')\n    };\n\n    // Switch to the connection tab\n    switchToTab('#connection-tab');\n\n    // Clear the feedback form\n    $('.feedback-choice.selected').removeClass('selected');\n    $('#feedback-comments').val('');\n    $('#feedback-email').val('');\n    $('#feedback-send-diagnostic').prop('checked', true);\n\n    // Actually send the feedback\n    HtmlCtrlInterface_SendFeedback(JSON.stringify(fields));\n\n    // Show (and hide) the success alert\n    displayCornerAlert($('#feedback-success-alert'));\n  }\n\n\n  /* LOGS **********************************************************************/\n\n  $(function() {\n    $('#show-debug-logs').click(showDebugLogsClicked);\n\n    // Set the initial show-debug state\n    var show = $('#show-debug-logs').prop('checked');\n    $('.log-messages')\n      .toggleClass('showing-priority-0', show)\n      .toggleClass('hiding-priority-0', !show);\n  });\n\n  function showDebugLogsClicked() {\n    /*jshint validthis:true */\n    var show = $(this).prop('checked');\n    // We use both a showing and a hiding class to try to deal with IE7's CSS insanity.\n    $('.log-messages')\n      .toggleClass('showing-priority-0', show)\n      .toggleClass('hiding-priority-0', !show);\n  }\n\n  // Expects obj to be of the form {priority: 0|1|2, message: string}\n  function addLog(obj) {\n    $('.log-messages .placeholder').remove();\n\n    $('.log-messages').loadTemplate(\n      $(\"#log-template\"),\n      {\n        timestamp: new Date().toLocaleTimeString(),\n        message: obj.message,\n        priority: 'priority-' + obj.priority\n      },\n      {\n        prepend:true\n      });\n\n    // The \"Show Debug Logs\" checkbox is hidden until we actually get a debug\n    // message.\n    if (obj.priority < 1) {\n      $('#logs-pane .invisible').removeClass('invisible');\n    }\n\n    // Record the priorities we've seen.\n    // We'll keep them in a (fake) Set.\n    addLog.priorities = addLog.priorities || {};\n    addLog.priorities[obj.priority] = true;\n\n    // Don't allow the log messages list to grow forever!\n    // We'll set a limit for each priority. (Arbitrarily. May need to revisit.)\n    var MAX_LOGS_PER_PRIORITY = 200;\n    var priorities = _.keys(addLog.priorities);\n    for (var i = 0; i < priorities.length; i++) {\n      $('.log-messages .priority-'+priorities[i]).slice(MAX_LOGS_PER_PRIORITY).remove();\n    }\n  }\n\n  // Used for temporary debugging messages.\n  function DEBUG_LOG() {\n    debugLogHelper(window.console.log, Array.prototype.slice.call(arguments));\n  }\n\n  function DEBUG_WARN() {\n    debugLogHelper(window.console.warn, Array.prototype.slice.call(arguments));\n  }\n\n  function debugLogHelper(consoleLogger, args) {\n    if (!g_initObj.Config.Debug) {\n      return;\n    }\n\n    let msg = 'DEBUG:';\n    for (let i = 0; i < args.length; i++) {\n      msg += ' ';\n      if (_.isString(args[i])) {\n        msg += args[i];\n      }\n      else {\n        msg += JSON.stringify(args[i]);\n      }\n    }\n\n    addLog({priority: 0, message: msg});\n\n    const logger = (consoleLogger || window.console.log);\n    try {\n      if (IS_BROWSER) {\n        logger.apply(console, [msg]);\n      }\n    }\n    catch (e) {\n      // IE8 (at least IE8 mode in IE11) has weird console.log (etc.) implementations that\n      // are objects? But can still be called? But even trying to access .apply throws an\n      // exception? But calling it directly is okay?\n      logger(msg);\n    }\n  }\n\n\n  /* LANGUAGE ******************************************************************/\n\n  var RTL_LOCALES = ['devrtl', 'fa', 'fa_AF', 'ar', 'ur'];\n\n  $(function() {\n    var fallbackLanguage = 'en';\n\n    // Language priority: cookie, system locale, fallback\n    var lang = getCookie('language') ||\n                (g_initObj.Config && g_initObj.Config.Language) ||\n                fallbackLanguage;\n\n    i18n.init(\n      {\n        lang: lang,\n        fallbackLng: fallbackLanguage,\n        resStore: window.PSIPHON.LOCALES\n      },\n      function() {\n        switchLocale(lang, true);\n      });\n\n    // Populate the list of language choices\n    populateLocales();\n  });\n\n  // We only want to show the success/welcome message once.\n  var g_languageSuccessAlertShown = false;\n\n  // Other functions may need to know if we're currently using a RTL locale or not\n  var g_isRTL = false;\n\n  function switchLocale(locale, initial) {\n    i18n.setLng(locale, function() {\n      // This callback does not seem to called asynchronously (probably because\n      // we're loading from an object and not a remote resource). But we want this\n      // code to run after everything else is done, so we'll force it to be async.\n\n      nextTick(function() {\n        // HTML+JS use locale codes of the form 'en-US', rather than\n        // Psiphon's 'en_US'.\n        $('html').attr('lang', locale.replace('_', '-'));\n        $('body').i18n();\n\n        // The content of elements will have changed, so trigger custom event that can\n        // be listened for to take additional actions.\n        $window.trigger(LANGUAGE_CHANGE_EVENT);\n\n        if (!initial && !g_languageSuccessAlertShown) {\n          // Show (and hide) the success alert\n          g_languageSuccessAlertShown = true;\n          displayCornerAlert($('#language-success-alert'));\n        }\n\n        // Remember the user's choice\n        setCookie('language', locale);\n      });\n    });\n\n    //\n    // Right-to-left languages need special consideration.\n    //\n\n    var rtl = _.contains(RTL_LOCALES, locale);\n    g_isRTL = rtl;\n\n    $('body').attr('dir', rtl ? 'rtl' : 'ltr')\n             .css('direction', rtl ? 'rtl' : 'ltr');\n\n    // We'll use a data attribute to store classes which should only be used\n    // for RTL and not LTR, and vice-versa.\n    $('[data-i18n-rtl-classes]').each(function() {\n      var ltrClasses = $(this).data('i18n-ltr-classes');\n      var rtlClasses = $(this).data('i18n-rtl-classes');\n\n      if (ltrClasses) {\n        $(this).toggleClass(ltrClasses, !rtl);\n      }\n\n      if (rtlClasses) {\n        $(this).toggleClass(rtlClasses, rtl);\n      }\n    });\n\n    //\n    // Update C code string table with new language values\n    //\n\n    // Iterate through the English keys, since we know it will be complete.\n    var translation = window.PSIPHON.LOCALES.en.translation;\n    var appBackendStringTable = {};\n    for (var key in translation) {\n      if (!translation.hasOwnProperty(key)) {\n        continue;\n      }\n\n      if (_.startsWith(key, 'appbackend#')) {\n        appBackendStringTable[key] = i18n.t(key);\n      }\n    }\n\n    HtmlCtrlInterface_AddStringTableItem(locale, appBackendStringTable);\n  }\n\n  function populateLocales() {\n    var localePriorityGuide = ['en', 'fa', 'ar', 'zh', 'zh_CN', 'zh_TW'];\n    var locales = $.map(window.PSIPHON.LOCALES, function(val, key) { return key; });\n    // Sort the locales according to the priority guide\n    locales.sort(function(a, b) {\n      var localePriority_a = localePriorityGuide.indexOf(a);\n      var localePriority_b = localePriorityGuide.indexOf(b);\n      localePriority_a = (localePriority_a < 0) ? 999 : localePriority_a;\n      localePriority_b = (localePriority_b < 0) ? 999 : localePriority_b;\n\n      if (localePriority_a < localePriority_b) {\n        return -1;\n      }\n      else if (localePriority_a > localePriority_b) {\n        return 1;\n      }\n      else if (a < b) {\n        return -1;\n      }\n      else if (a > b) {\n        return 1;\n      }\n      return 0;\n    });\n\n    var $localeListElem = $('#language-pane');\n\n    for (var i = 0; i < locales.length; i++) {\n      // If we're not in debug mode, don't output the dev locales\n      if (!g_initObj.Config.Debug && _.startsWith(locales[i], 'dev')) {\n        continue;\n      }\n\n      $localeListElem.loadTemplate(\n        $(\"#locale-template\"),\n        { localeCode: locales[i],\n          localeName: window.PSIPHON.LOCALES[locales[i]].name},\n        { append: true });\n    }\n\n    // Set up the click handlers\n    $('.language-choice').click(function(e) {\n      e.preventDefault();\n      switchLocale($(this).data('locale'));\n    });\n  }\n\n\n  /* ABOUT *********************************************************************/\n\n  // No special code. Sponsor-specific links are set elsewhere.\n\n\n  /* PSICASH *******************************************************************/\n\n  /**\n   * PsiCash-related events.\n   * @enum {string}\n   * @readonly\n   */\n  const PsiCashEventTypeEnum = {\n    /** Argument is PsiCashRefreshData */\n    REFRESH: 'psicash::refresh',\n    /** Argument is PsiCashPurchaseResponse */\n    NEW_PURCHASE: 'psicash::new-purchase',\n    /** Argument is PsiCashInitDoneData */\n    INIT_DONE: 'psicash::init-done',\n    /** Argument is PsiCashLoginData */\n    LOGIN: 'psicash::login',\n    /** Argument is PsiCashLogoutData */\n    LOGOUT: 'psicash::logout'\n  };\n\n  /**\n   * Server response statuses\n   * @enum {number}\n   * @readonly\n   */\n  const PsiCashServerResponseStatus = {\n    Invalid: -1, // Should never be used if well-behaved\n    Success: 0,\n    ExistingTransaction: 1,\n    InsufficientBalance: 2,\n    TransactionAmountMismatch: 3,\n    TransactionTypeNotFound: 4,\n    InvalidTokens: 5,\n    InvalidCredentials: 6,\n    BadRequest: 7,\n    ServerError: 8\n  };\n\n  /**\n   * @typedef {Object} PsiCashPurchasePrice\n   * @property {!string} class\n   * @property {!string} distinguisher\n   * @property {!number} price\n   */\n\n   /**\n    * @typedef {Object} PsiCashPurchase\n    * @property {!string} id\n    * @property {!string} class\n    * @property {!string} distinguisher\n    * @property {!any} authorization\n    * @property {?moment} localTimeExpiry\n    * @property {?moment} serverTimeExpiry\n    */\n\n  /**\n   * The expected payload passed to HtmlCtrlInterface_PsiCashMessage when a purchase is complete.\n   * @typedef {Object} PsiCashPurchaseResponse\n   * @property {?string} error\n   * @property {!PsiCashServerResponseStatus} status\n   * @property {?PsiCashRefreshData} refresh\n   */\n\n  /**\n   * The expected payload passed to HtmlCtrlInterface_PsiCashMessage when a refresh should be done.\n   * @typedef {Object} PsiCashRefreshData\n   * @property {boolean} is_account\n   * @property {boolean} has_tokens\n   * @property {?string} account_username Will be set iff is_account is true and has_tokens is true\n   * @property {number} balance\n   * @property {PsiCashPurchasePrice[]} purchase_prices\n   * @property {PsiCashPurchase[]} purchases\n   * @property {?string} buy_psi_url\n   * @property {string} account_signup_url\n   * @property {string} account_management_url\n   */\n\n  /**\n   * The expected payload passed to HtmlCtrlInterface_PsiCashMessage when PsiCash.Init() is done.\n   * @typedef {Object} PsiCashInitDoneData\n   * @property {?string} error\n   * @property {?boolean} recovered\n   */\n\n  /**\n   * The expected payload passed to HtmlCtrlInterface_PsiCashMessage when account login is complete.\n   * @typedef {Object} PsiCashLoginResponse\n   * @property {?string} error\n   * @property {!PsiCashServerResponseStatus} status\n   * @property {?boolean} last_tracker_merge\n   * @property {?PsiCashRefreshData} refresh\n   */\n\n  /**\n   * The expected payload passed to HtmlCtrlInterface_PsiCashMessage when account logout is complete.\n   * @typedef {Object} PsiCashLogoutResponse\n   * @property {?string} error\n   * @property {?PsiCashRefreshData} refresh\n   */\n\n  /**\n   * Used as the \"command\" type passed to HtmlCtrlInterface_PsiCashCommand.\n   * @enum {string}\n   * @readonly\n   */\n  const PsiCashCommandEnum = {\n    REFRESH: 'refresh',\n    PURCHASE: 'purchase',\n    LOGIN: 'login',\n    LOGOUT: 'logout'\n  };\n\n  /**\n   * PsiCash command base class constrcutor\n   * @class PsiCashCommandBase\n   * @classdesc Should only be used by subclasses\n   * @param {PsiCashCommandEnum} command\n   */\n  function PsiCashCommandBase(command) {\n    /**\n     * @name PsiCashCommandBase#command\n     * @type {PsiCashCommandEnum}\n     */\n    this.command = command;\n\n    /**\n     * @name PsiCashCommandBase#id\n     * @type {string}\n     */\n    this.id = randomID();\n  }\n\n  /**\n   * Construct a new refresh command\n   * @class PsiCashCommandRefresh\n   * @classdesc Passed to HtmlCtrlInterface_PsiCashCommand to indicate a data refresh is desired\n   * @param {string} reason Indicates the reason for the refresh (used for logging and debugging)\n   */\n  function PsiCashCommandRefresh(reason) {\n    PsiCashCommandBase.call(this, PsiCashCommandEnum.REFRESH);\n    this.reason = reason;\n  }\n  PsiCashCommandRefresh.prototype = _.create(PsiCashCommandBase.prototype, {constructor: PsiCashCommandRefresh});\n\n  /**\n   * Construct a new purchase command\n   * @class PsiCashCommandPurchase\n   * @classdesc Passed to HtmlCtrlInterface_PsiCashCommand to indicate a purchase is desired\n   * @param {string} transactionClass\n   * @param {string} distinguisher\n   * @param {number} expectedPrice\n   */\n  function PsiCashCommandPurchase(transactionClass, distinguisher, expectedPrice) {\n    PsiCashCommandBase.call(this, PsiCashCommandEnum.PURCHASE);\n    this.transactionClass = transactionClass;\n    this.distinguisher = distinguisher;\n    this.expectedPrice = expectedPrice;\n  }\n  PsiCashCommandPurchase.prototype = _.create(PsiCashCommandBase.prototype, {\n    constructor: PsiCashCommandPurchase\n  });\n\n  /**\n   * Construct a new PsiCash account login command\n   * @class PsiCashCommandLogin\n   * @classdesc Passed to HtmlCtrlInterface_PsiCashCommand to indicate a purchase is desired\n   * @param {string} username\n   * @param {string} password\n   */\n  function PsiCashCommandLogin(username, password) {\n    PsiCashCommandBase.call(this, PsiCashCommandEnum.LOGIN);\n    this.username = username;\n    this.password = password;\n  }\n  PsiCashCommandLogin.prototype = _.create(PsiCashCommandBase.prototype, {constructor: PsiCashCommandLogin});\n\n  /**\n   * Construct a new PsiCash account logout command\n   * @class PsiCashCommandLogout\n   * @classdesc Passed to HtmlCtrlInterface_PsiCashCommand to indicate a purchase is desired\n   */\n  function PsiCashCommandLogout() {\n    PsiCashCommandBase.call(this, PsiCashCommandEnum.LOGOUT);\n  }\n  PsiCashCommandLogout.prototype = _.create(PsiCashCommandBase.prototype, {\n    constructor: PsiCashCommandLogout\n  });\n\n  /**\n   * PsiCash-related messages from the C code.\n   * @enum {string}\n   * @readonly\n   */\n  const PsiCashMessageTypeEnum = {\n    REFRESH: 'refresh',\n    NEW_PURCHASE: 'new-purchase',\n    INIT_DONE: 'init-done',\n    LOGIN: 'account-login',\n    LOGOUT: 'account-logout'\n  };\n\n  /**\n   * @typedef {Object} PsiCashMessageData\n   * @property {PsiCashMessageTypeEnum} type\n   * @property {string} id\n   * @property {PsiCashRefreshData} payload\n   */\n\n  // TODO: Maybe roll this into a more global pubsub? But why?\n  /** @type {Datastore} */\n  const PsiCashStore = new Datastore({\n    initDone: false,\n    purchaseInProgress: false,\n    uiState: null\n  }, 'PsiCashStore');\n\n  $(function psicashInit() {\n    // NOTE: \"refresh\" will not make a server request unless we're connected. If not\n    // connected, it just gets locally cached values.\n\n    // And update the UI values every time the app gets focus.\n    addWindowFocusHandler(function() {\n      if (!PsiCashStore.data.initDone) {\n        return;\n      }\n      HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('app-focus'));\n    });\n\n    // And update the UI values every time we get connected.\n    $window.on(CONNECTED_STATE_CHANGE_EVENT, function() {\n      if (!PsiCashStore.data.initDone) {\n        return;\n      }\n      HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('connected-state-change'));\n    });\n\n    // And update the UI values every time the display language changes, so that the numbers\n    // are correctly formatted.\n    $window.on(LANGUAGE_CHANGE_EVENT, function() {\n      if (!PsiCashStore.data.initDone) {\n        return;\n      }\n      HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('ui-language-change'));\n    });\n\n    // And update the UI when the settings change. If we go into/out of VPN mode we need to\n    // disable the UI and indicate why.\n    $('#settings-pane').on(SETTING_CHANGED_EVENT, function() {\n      if (!PsiCashStore.data.initDone) {\n        return;\n      }\n      HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('settings-changed'));\n    });\n\n    // We're going to set this click handler on the parent rather than the link, since the\n    // link element is going to be replaced on each language change (alternatively, we\n    // could set this on language change, but this is easier and fine).\n    $('.vpn-mode-ui a').parent().on('click', function(e) {\n      e.preventDefault();\n      showSettingsSection('#settings-accordion-transport-mode');\n      return false;\n    });\n\n    // Disallow external links (that don't have their own special handlers) from opening\n    // if we're not connected (per PsiCash behaviour rules).\n    $('a.js-psicash-account-signup, a.js-psicash-account-management').on('click', function(e) {\n      if (g_lastState !== 'connected') {\n        e.preventDefault();\n        showNoticeModal(\n          'psicash#mustconnect-modal#title',\n          'psicash#mustconnect-modal#body',\n          'info',\n          null, null,\n          function() {\n            switchToTab('#connection-tab');\n          }\n        );\n      }\n    });\n  });\n\n  /**\n   * Handles the message indicating that the PsiCash library failed to initialize.\n   * @param {*} evt Event. Unused.\n   * @param {PsiCashInitDoneData} data\n   */\n  function psiCashLibraryInitDone(evt, data) {\n    if (data.error) {\n      // The library failed to initialize. This is very bad. The user lost their Tracker credit\n      // or their Account logged-in state.\n      if (data.recovered) {\n        showNoticeModal(\n          'psicash#init-error-title',\n          'psicash#init-error-body-recovered',\n          'error',\n          'general#notice-modal-tech-preamble',\n          data.error,\n          null); // callback\n      }\n      else {\n        showNoticeModal(\n          'psicash#init-error-title',\n          'psicash#init-error-body-unrecovered',\n          'error',\n          'general#notice-modal-tech-preamble',\n          data.error,\n          null); // callback\n      }\n    }\n\n    PsiCashStore.set('initDone', true);\n    HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('init-done'));\n  }\n  $window.on(PsiCashEventTypeEnum.INIT_DONE, psiCashLibraryInitDone);\n\n  /**\n   * Helper function to determine if PsiCash is ready for use.\n   * @param {?PsiCashRefreshData} psicashData The data to use for the check. If not provided,\n   *    g_PsiCashData will be used.\n   */\n  function psiCashStateInitialized(psicashData) {\n    // If we have tokens then we're initialized, or if we have an account (regardless of\n    // tokens, because we might be logged out).\n    return psicashData.has_tokens || psicashData.is_account;\n  }\n\n  var PSICASH_ENABLED_COOKIE = 'psicash::Enabled';\n\n  /**\n   * Called when PsiCash-related data should be refreshed. This may or may not mean that\n   * a request was made to the server to get fresh data.\n   * @param {PsiCashRefreshData} data\n   */\n  function refreshPsiCashEventHandler(evt, data) {\n    psiCashUIUpdater(data);\n  }\n  $window.on(PsiCashEventTypeEnum.REFRESH, refreshPsiCashEventHandler);\n\n  /** @type {?PsiCashRefreshData} */\n  var g_PsiCashData = null;\n\n  /**\n   * The state determines which chunks of UI are visible.\n   * @enum {object}\n   * @readonly\n   */\n  const PsiCashUIState = {\n    NSF_BALANCE: {uiSelector: '#psicash-corner-nsfbalance'},\n    ENOUGH_BALANCE: {uiSelector: '#psicash-corner-enoughbalance'},\n    BUYING_BOOST: {uiSelector: '#psicash-corner-buyingboost'},\n    ACTIVE_BOOST: {uiSelector: '#psicash-corner-activeboost'},\n    VPN_MODE_DISABLED: {uiSelector: '#psicash-corner-vpndisabled'},\n    ACCOUNT_LOGGED_OUT: {uiSelector: '#psicash-corner-accountloggedout'}\n  };\n  PsiCashStore.set('uiState', PsiCashUIState.NSF_BALANCE);\n\n  /**\n   * Called from refreshPsiCash and on an interval to update the PsiCash UI.\n   * @param {?PsiCashRefreshData} psicashData Will be undefined when called on a timer.\n   */\n  function psiCashUIUpdater(psicashData) {\n    // This must be set by any code below that queues up another call to this function via\n    // setTimeout. This is to prevent building up a flood of redundant calls.\n    if (!psiCashUIUpdater.timeout) {\n      psiCashUIUpdater.timeout = null;\n    }\n\n    // g_PsiCashData gets reassigned in the next if-block, but we want to be able to\n    // reference the previous state. Note that this may be null.\n    const oldPsiCashData = g_PsiCashData;\n\n    if (psicashData) {\n      let reconnectRequired = false; // TBD below\n\n      if (g_PsiCashData) {\n        // For later diagnostics, log if psicashData values changed\n        if (!_.isNaN(psicashData.balance) && psicashData.balance !== g_PsiCashData.balance) {\n          HtmlCtrlInterface_Log('PsiCash: balance change:', psicashData.balance - g_PsiCashData.balance);\n        }\n        // TODO: Log other changes? Kind of a hassle.\n\n        // We might need to reconnect, based on the new data. There are two possible reasons:\n        // 1. If there are new purchases with authorizations present -- possibly due to a\n        //    new Speed Boost purchase or login purchase retrieval, then we need to\n        //    reconnect to have the authorization(s) take effect.\n        // 2. If there were authorizations active, but our tokens just disappeared\n        //    (due logout or expiry).\n        // Note that we _don't_ need to reconnect when an authorization expires,\n        // as that is handled by tunnel-core/psiphond.\n        if (psicashData.purchases) {\n          for (let i = 0; i < psicashData.purchases.length; i++) {\n            const newPurchase = psicashData.purchases[i];\n            if (!newPurchase.authorization) {\n              continue;\n            }\n            if (!g_PsiCashData.purchases) {\n              DEBUG_LOG('psiCashUIUpdated: reconnect required due to new purchase authorization');\n              reconnectRequired = true;\n              break;\n            }\n            if (!g_PsiCashData.purchases.some((p) => p.id === newPurchase.id)) {\n              DEBUG_LOG('psiCashUIUpdated: reconnect required due to unmatched purchase authorization');\n              reconnectRequired = true;\n              break;\n            }\n          }\n        }\n        if (!psicashData.has_tokens &&\n            g_PsiCashData.has_tokens &&\n            g_PsiCashData.purchases &&\n            g_PsiCashData.purchases.some((p) => !!p.authorization)) {\n          DEBUG_LOG('psiCashUIUpdated: reconnect required due to loss of tokens');\n          reconnectRequired = true;\n        }\n      }\n\n      g_PsiCashData = psicashData;\n\n      if (reconnectRequired) {\n        // We'll continue with our UI update, but we need to reconnect to apply\n        // newly-arrived purchases.\n        HtmlCtrlInterface_ReconnectTunnel(/*suppressHomePage=*/true);\n      }\n    }\n\n    if (!g_PsiCashData) {\n      // No data to use, nothing to do.\n      return;\n    }\n\n    psicashData = g_PsiCashData;\n\n    /**\n     * Will be true for the very first update when the UI is enabled. Affects which animations are shown.\n     */\n    let veryFirstUpdate = false;\n\n    // The enabled cookie will not be present on the very first run, and is set to true\n    // when we first enter a state where the PsiCash UI can be shown (and the onboarding\n    // presented).\n    if (getCookie(PSICASH_ENABLED_COOKIE)) {\n      // Even if the cookie is present, the user might have deleted their psicashdatastore\n      // file, so double-check the sanity of our state.\n      if (!psiCashStateInitialized(psicashData)) {\n        setCookie(PSICASH_ENABLED_COOKIE, false);\n        // Re-call this function to start all over.\n        return psiCashUIUpdater(psicashData);\n      }\n    }\n    else {\n      // Check if we're in a state where the functionality can be enabled.\n      if (windowHasFocus()\n          && psiCashStateInitialized(psicashData)\n          && g_lastState === 'connected')\n      {\n        // We're in a good state, and this is the very first time.\n        HtmlCtrlInterface_Log('PsiCash: very first update');\n        veryFirstUpdate = true;\n        setCookie(PSICASH_ENABLED_COOKIE, true);\n        // TODO: onboarding\n      }\n      else {\n        // PsiCash is still disabled, so there's nothing to do.\n        return;\n      }\n    }\n\n    let state = PsiCashUIState.NSF_BALANCE;\n    // DO NOT return early from this point. state must be updated in PsiCashStore.uiState.\n\n    if (psicashData.purchase_prices) {\n      for (let i = 0; i < psicashData.purchase_prices.length; i++) {\n        let pp = psicashData.purchase_prices[i];\n        if (pp['class'] === 'speed-boost' && pp.price <= psicashData.balance) {\n          // We can afford at least one level of Speed Boost\n          state = PsiCashUIState.ENOUGH_BALANCE;\n          break;\n        }\n      }\n    }\n\n    let millisOfSpeedBoostRemaining = 0;\n\n    if (psicashData.purchases) {\n      for (let i = 0; i < psicashData.purchases.length; i++) {\n        // There are two different contexts/ways of checking for active Speed Boost.\n        // **If we are connected**, then we rely on psiphond to decide that the\n        // authorization is expired, which will result in tunnel-core reconnecting and a\n        // signal that the authorization is now rejected. This is when the purchase is\n        // actually removed from the PsiCash lib datastore. So, if we are connected, its\n        // presence in the purchases array should be interpreted as meaning that the\n        // purchase/authorization is valid.\n        // **If we are not connected**, then we have to rely on the purchase expiry.\n        // (We're certainly not going to show a purchase as active for hours too long\n        // until the user happens to connect and refresh PsiCash state.)\n        // Note: We're making no special effort to check for multiple active Speed Boosts.\n        // This should not happen, per server rules.\n        if (psicashData.purchases[i]['class'] === 'speed-boost') {\n          const localTimeExpiry = moment(psicashData.purchases[i].localTimeExpiry);\n          if (g_lastState === 'connected' || localTimeExpiry.isAfter(moment())) {\n            state = PsiCashUIState.ACTIVE_BOOST;\n\n            millisOfSpeedBoostRemaining = localTimeExpiry.diff(moment());\n            // Clock skew (between client<->PsiCash server<->psiphond) could result in a\n            // purchase being used past the expiry in the purchase record. Ensure we're\n            // not showing a negative value in the UI.\n            millisOfSpeedBoostRemaining = Math.max(0, millisOfSpeedBoostRemaining);\n            break;\n          }\n        }\n      }\n    }\n\n    if (PsiCashStore.data.purchaseInProgress) {\n      // We are waiting for a purchase request to complete\n      state = PsiCashUIState.BUYING_BOOST;\n    }\n\n    if (psicashData.is_account && !psicashData.has_tokens) {\n      // If we're in an account-logged-out state, PsiCash functionality is disabled until\n      // the user logs back in (or resets data).\n      state = PsiCashUIState.ACCOUNT_LOGGED_OUT;\n    }\n\n    // If we are newly transitioning into a logged out state, let the user know\n    if (state === PsiCashUIState.ACCOUNT_LOGGED_OUT && oldPsiCashData && oldPsiCashData.has_tokens) {\n      displayCornerAlert($('#psicash-account-tokens-expired-alert'));\n      // Log to UI and to diagnostics\n      addLog({priority: 2, message: 'Account logged out; probably due to expired tokens'});\n      HtmlCtrlInterface_Log('Account logged out; probably due to expired tokens');\n    }\n\n    // Speed Boost cannot function in L2TP/IPSec mode. We want to disabled controls and\n    // indicate why we're in that state.\n    if (g_initObj.Settings.VPN) {\n      state = PsiCashUIState.VPN_MODE_DISABLED;\n    }\n\n    // Show and hide the appropriate parts of the UI\n    syncPsiCashUI(psicashData, state, millisOfSpeedBoostRemaining);\n\n    // Now that the correct interface is showing, update the balance\n    PsiCashBalanceChange.push(psicashData.balance, veryFirstUpdate);\n\n    // Some UI elements (i.e., the turtle speed limit) don't apply to users with a high\n    // baseline speed. So we'll selectively show/hide those elements depending on the\n    // the Psiphon speed limit.\n    const baselineRateLimit = getCookie('BaselineRateLimit');\n    const threshold = (5 << 20) / 8; // 5 mbps in bytes; arbitrarily \"fast\"\n    if (!baselineRateLimit || baselineRateLimit > threshold) {\n      // Either we don't yet have a baseline, or it's above the threshold\n      DEBUG_LOG('Baseline speed is high; hiding speed limit');\n      $('.js-hide-if-fast').addClass('hidden');\n    }\n    else {\n      // The baseline is below the threshold\n      DEBUG_LOG('Baseline speed is low; showing speed limit');\n      $('.js-hide-if-fast').removeClass('hidden');\n    }\n\n    // When we have an active speed boost, we want this function to be called repeatedly,\n    // so that the countdown timer is updated, and so the UI changes when the speed boost\n    // ends. But there's no reason to do work on an interval if there's no active boost.\n    if (state === PsiCashUIState.ACTIVE_BOOST) {\n      // There are triggers that result in this function being called, and we don't want\n      // to create periodic update timeouts every time, or else we'll end up with updates\n      // happening way too often (multiple times per second).\n      clearTimeout(psiCashUIUpdater.timeout);\n\n      // Wait longer between updates if there's a lot of time left in the boost.\n      if (millisOfSpeedBoostRemaining < 120 * 1000) {\n        psiCashUIUpdater.timeout = setTimeout(psiCashUIUpdater, 1000);\n      }\n      else {\n        psiCashUIUpdater.timeout = setTimeout(psiCashUIUpdater, 60 * 1000);\n      }\n    }\n\n    PsiCashStore.set('uiState', state);\n\n    /**\n     * Update relevant parts of the UI, depending on state and data\n     * @param {!PsiCashRefreshData} psicashData\n     * @param {!object} state\n     * @param {?Number} millisOfSpeedBoostRemaining\n     */\n    function syncPsiCashUI(psicashData, state, millisOfSpeedBoostRemaining) {\n      // Show the appropriate corner content\n      $('.js-psicash-corner').not(state.uiSelector).addClass('hidden');\n      $(state.uiSelector).removeClass('hidden');\n\n      // We can't use `state === PsiCashUIState.ACCOUNT_LOGGED_OUT` to determine this\n      // condition because VPN_MODE_DISABLED will supersede ACCOUNT_LOGGED_OUT.\n      const loggedOut = (psicashData.is_account && !psicashData.has_tokens);\n\n      $('.js-show-if-boosting').toggleClass('hidden', state !== PsiCashUIState.ACTIVE_BOOST);\n      $('.js-hide-if-boosting').toggleClass('hidden', state === PsiCashUIState.ACTIVE_BOOST);\n\n      $('.js-show-if-is-account').toggleClass('hidden', !psicashData.is_account);\n      $('.js-show-if-not-is-account').toggleClass('hidden', psicashData.is_account);\n      $('.js-show-if-logged-out-account').toggleClass('hidden', !loggedOut);\n      $('.js-hide-if-logged-out-account').toggleClass('hidden', loggedOut);\n\n      $('.js-show-if-nsf').toggleClass('hidden', state !== PsiCashUIState.NSF_BALANCE);\n      $('.js-hide-if-nsf').toggleClass('hidden', state === PsiCashUIState.NSF_BALANCE);\n\n      $('.psicash-username-container .js-psicash-account-signup').toggleClass('hidden', !!psicashData.account_username || loggedOut);\n      $('.psicash-username-container .psicash-username').text(psicashData.account_username).toggleClass('hidden', !psicashData.account_username);\n\n      if (psicashData.buy_psi_url) {\n        $('a.psicash-buy-psi').prop('href', psicashData.buy_psi_url).removeClass('hidden');\n      }\n      else {\n        // For some states, hiding the \"buy\" button will look strange, but since that\n        // implies there's no earner token, the whole PsiCash UI will be hidden anyway.\n        $('a.psicash-buy-psi').addClass('hidden');\n      }\n\n      $('a.js-psicash-account-signup').prop('href', psicashData.account_signup_url);\n      $('a.js-psicash-account-management').prop('href', psicashData.account_management_url);\n\n      if (psicashData.purchase_prices) {\n        for (let i = 0; i < psicashData.purchase_prices.length; i++) {\n          let pp = psicashData.purchase_prices[i];\n\n          if (pp['class'] === 'speed-boost') {\n            $(`.js-psicash-sb-price[data-distinguisher=\"${pp.distinguisher}\"]`).text(formatPsi(parseInt(pp.price)));\n            $(`.js-psicash-sb-price[data-distinguisher=\"${pp.distinguisher}\"]`).data('expectedPrice', pp.price);\n\n            $(`.speed-boost-button[data-distinguisher=\"${pp.distinguisher}\"], .js-max-boost-container .js-psicash-buy-speedboost-price[data-distinguisher=\"${pp.distinguisher}\"]`)\n                .toggleClass('enough-balance', psicashData.balance >= pp.price);\n            $(`.speed-boost-button[data-distinguisher=\"${pp.distinguisher}\"], .js-max-boost-container .js-psicash-buy-speedboost-price[data-distinguisher=\"${pp.distinguisher}\"]`)\n                .toggleClass('not-enough-balance', psicashData.balance < pp.price);\n          }\n        }\n\n        // Set proper visibility for the \"buy max boost\" button.\n        const maxEnoughBalance = $('.js-max-boost-container .js-psicash-buy-speedboost-price').addClass('hidden').filter('.enough-balance').last();\n        maxEnoughBalance.removeClass('hidden');\n        // Set the distinguisher on the button so the handler can pick it up.\n        $('.js-max-boost-container').data('distinguisher', maxEnoughBalance.data('distinguisher'));\n      }\n\n      const boostRemainingTime = moment\n          .duration(millisOfSpeedBoostRemaining)\n          .locale(momentLocale())\n          .humanize()\n          .replace(' ', '&nbsp;'); // avoid splitting the time portion\n      const boostRemainingText = i18n.t('psicash#ui-speedboost-active').replace('%s', boostRemainingTime);\n      $('.speed-boost-time-remaining').html(boostRemainingText);\n\n      const vpnMode = $('#VPN').prop('checked');\n      $('.js-show-if-vpn-mode').toggleClass('hidden', !vpnMode);\n      $('.js-hide-if-vpn-mode').toggleClass('hidden', vpnMode);\n\n      // Show the whole corner block, if it's hidden.\n      if ($('#psicash-block, #psicash-tab').hasClass('hidden')) {\n        $('#psicash-block, #psicash-tab').removeClass('hidden');\n\n        // Some layout actions like height-matching won't have succeeded while the\n        // UI was hidden. So do a content-resize with the newly visible content.\n        nextTick(resizeContent);\n      }\n    }\n  }\n\n  /**\n   * Update the UI to a new balance, complete with animations.\n   * @param {number} newBalance The balance to update the UI to match.\n   * @param {boolean} veryFirstUpdate Whether this is the very first balance update\n   *    (determines which animations are used).\n   * @returns {jQuery.Promise} A promise that will be resolved when the update animations\n   *    are complete.\n   */\n  function doBalanceChange(newBalance, veryFirstUpdate) {\n    const allDoneDefer = $.Deferred();\n\n    // There are two different kinds of balance display elements: those that get animated\n    // on balance change (.js-psicash-balance-anim) and those that don't (.js-psicash-balance-noanim).\n    // Start by directly updating the non-animated elements.\n    $('.js-psicash-balance-noanim').text(formatPsi(newBalance));\n\n    let previousBalance = parseInt($('.js-psicash-balance-anim').data('psicash-balance')); // may be NaN\n    if (_.isNaN(previousBalance)) {\n      // If this is the very first refresh after the UI is enabled, we want to animate the\n      // balance change. But if this is just an app start-up that's restoring a previous\n      // balance, then we don't.\n      const startingPoint = veryFirstUpdate ? 0 : newBalance;\n      $('.js-psicash-balance-anim').text(formatPsi(startingPoint)).data('psicash-balance', startingPoint);\n      previousBalance = startingPoint;\n    }\n    else {\n      // Update the value of the balance field. This is mostly so that a post-language-change\n      // refresh will show the balance in the correct format.\n      $('.js-psicash-balance-anim').text(formatPsi(previousBalance));\n    }\n\n    let balanceDiff = newBalance - previousBalance;\n\n    // If the diff is 0, we're not going to update anything. Otherwise we're going to\n    // animate the change.\n    if (balanceDiff === 0) {\n      allDoneDefer.resolve();\n      return allDoneDefer.promise();\n    }\n\n    balanceDiff = _.isNaN(balanceDiff) ? newBalance : balanceDiff;\n\n    // Set the data value to the real balance immediately, to prevent later confusion.\n    $('.js-psicash-balance-anim').data('psicash-balance', newBalance);\n\n    // We're going to animate the balance increasing. We need to figure out the steps.\n    const BILLION = 1e9;\n    const balanceStepTime = 2000;   // ms\n    const balanceStopInterval = 25; // ms\n    const maxSteps = Math.trunc(balanceStepTime / balanceStopInterval);\n\n    // We only want to consider billions\n    const gigaBalanceDiff = balanceDiff / BILLION;\n\n    let balanceStepCount = Math.max(1, Math.min(Math.abs(gigaBalanceDiff), maxSteps));\n    const balanceStepSize = Math.trunc(gigaBalanceDiff / balanceStepCount) * BILLION;\n\n    // If we only stepped balanceStepSize, the last step might be huge. So we'll\n    // take some larger steps at the start.\n    let extraStepSize = balanceDiff - (Math.sign(balanceDiff) * balanceStepCount * balanceStepSize);\n\n    let intermediateBalance = previousBalance;\n\n    const $visiblePsiCashInterface = $('#psicash-block .js-psicash-corner').not('.hidden');\n    const $visibleBalanceElem = $visiblePsiCashInterface.find('.js-psicash-balance-anim');\n\n    // There are two different aynchronous animations that we want to want to wait\n    // on before declaring this balance change complete: The number ticking up or down,\n    // and the CSS delta transition. We're going to use promises to keep track of them finishing.\n    const tickDefer = $.Deferred();\n    const deltaDefer = $.Deferred();\n    $.when(tickDefer.promise(), deltaDefer.promise()).always(() => {\n      // Resolve the master deferred\n      allDoneDefer.resolve();\n    });\n\n    const finalTickStep = (balanceTickInterval) => {\n      if (!balanceTickInterval) {\n        return;\n      }\n      clearInterval(balanceTickInterval);\n      balanceTickInterval = null;\n      // Update all balance fields, not just the visible one.\n      $('.js-psicash-balance-anim').text(formatPsi(newBalance));\n      // Ticking is all done\n      tickDefer.resolve();\n    };\n\n    let balanceTickInterval = setInterval(() => {\n      balanceStepCount--;\n      if (balanceStepCount < 1) {\n        // Ticking is done\n        finalTickStep(balanceTickInterval);\n        return;\n      }\n\n      intermediateBalance += balanceStepSize;\n      if (extraStepSize > BILLION) {\n        intermediateBalance += BILLION;\n        extraStepSize -= BILLION;\n      }\n      $visibleBalanceElem.text(formatPsi(intermediateBalance));\n    }, 10);\n\n    // If our animation is super slow, the whole thing might take too long, so we're\n    // also going to time-bound the whole process.\n    setTimeout(() => {\n      finalTickStep(balanceTickInterval);\n    }, balanceStepTime);\n\n    // We're going to test that $visibleBalanceElem actually exists, otherwise we risk\n    // never resolving the animation promise.\n    if ($visibleBalanceElem.length > 0) {\n      let psiText = formatPsi(balanceDiff);\n      if (balanceDiff > 0) {\n        // Negative numbers naturally get a '-', but we'll need to add a '+' sign (localized)\n        psiText = i18n.t('positive-value-indicator').replace('%d', formatPsi(balanceDiff));\n      }\n\n      // Create and insert the element we'll use for the animation\n      const $deltaElem = $('<span class=\"psicash-balance-delta\"></span>')\n                          .addClass((balanceDiff > 0) ? 'credit' : 'debit')\n                          .text(psiText)\n                          .insertAfter($visibleBalanceElem);\n\n      // It's unfortunate that we have to do the animation using jQuery's .animate()\n      // rather than CSS transitions, but transitions seem flaky in IE.\n      const animationCSSEnpoint = (balanceDiff > 0) ?\n        // credit\n        {\n          'font-size': '0',\n          'opacity': '0.4'\n        } :\n        // debit\n        {\n          'font-size': '500%',\n          'opacity': '0'\n        };\n\n      const animationPromise = $deltaElem\n        .delay(10)\n        .addClass('balance-changing')\n        .animate(animationCSSEnpoint, {\n          duration: (balanceDiff > 0) ? balanceStepTime : balanceStepTime,\n          easing: 'swing',\n          queue: true })\n        .promise();\n\n      animationPromise.always(() => {\n          $deltaElem.remove();\n          deltaDefer.resolve();\n      });\n    }\n    else {\n      // We're not doing the transition animation, so just resolve the deferred\n      deltaDefer.resolve();\n    }\n\n    return allDoneDefer.promise();\n  }\n\n  /**\n   * Used to queue balance changes. Required to make sure animations don't get messed up.\n   */\n  const PsiCashBalanceChange = {\n    /**\n     * The queue of balances to change to\n     * @type {number[]}\n     * @private\n     */\n    _queue: [],\n\n    /**\n     * Whether the next balance change will be the very first one\n     * @type {boolean}\n     * @private\n     */\n    _first: false,\n\n    /**\n     * Enqueues the given balance to change the UI to.\n     * @param {!number} newBalance The balance to change to.\n     * @param {!boolean} first Whether this is the very first balance change ever (not just\n     *  a fresh app start-up).\n     */\n    push: function PsiCashBalanceChange_push(newBalance, first) {\n      if (!_.isNumber(newBalance)) {\n        return;\n      }\n\n      // This properly be stored in the queue, but it doesn't matter. There will only ever\n      // be one \"first\", and it'll be the first change.\n      this._first = first;\n\n      this._queue.push(newBalance);\n\n      if (this._queue.length === 1) {\n        // We're not already processing the queue and need to start\n        nextTick(this._pop, this);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _pop: function PsiCashBalanceChange_pop() {\n      if (this._queue.length === 0) {\n        // We're done\n        return;\n      }\n\n      // We process the next item in the queue before removing it. Its presence acts as a\n      // flag that we're processing.\n      const nextBalance = this._queue[0];\n      const changePromise = doBalanceChange(nextBalance, this._first);\n      this._first = false;\n\n      changePromise.always(() => {\n        this._queue.shift();\n        // Keep processing the queue\n        this._pop();\n      });\n    }\n  };\n\n  /**\n   * Gets the moment locale matching the current UI locale.\n   * @returns {!string}\n   */\n  function momentLocale() {\n    let locale = $('html').attr('lang');\n    if (_.startsWith(locale, 'dev')) {\n      // Moment has different locale codes for pseudolocales.\n      locale = 'x-pseudo';\n    }\n\n    // `locale` is now our starting point. Moment has case-sensitive locale matches, but\n    // also has case-inconsistent locale names (e.g., it has \"en-SG\" in the current\n    // release, although that looks to be changed in a future release). It also has\n    // exact matching, so it won't recognize \"zh\" even though it has \"zh-cn\". So we\n    // need to do some massaging and fuzzy-matching.\n    locale = locale.toLowerCase();\n\n    // Just in case we have \"en_US\" instead of \"en-US\".\n    locale = locale.replace('_', '-');\n\n    // Moment uses \"uz-latn\" rather than \"uz@Latn\"\n    locale = locale.replace('@', '-');\n\n    let subLocale = locale.split('-')[0];\n\n    let exactLocaleMatch, subLocaleMatch;\n    const momentLocales = moment.locales();\n    for (let i = 0; i < momentLocales.length; i++) {\n      const l = momentLocales[i];\n      if (l.toLowerCase() === locale) {\n        exactLocaleMatch = l;\n        break;\n      }\n\n      // We'll also check \"sub-locales\". This means that if locale is \"pt-pt\" then we want\n      // to match \"pt\", and if locale is \"zh\" we want to match \"zh-cn\".\n      if (subLocale === l) {\n        subLocaleMatch = l;\n      }\n      // HACK: We're only going to record the first sub-locale match, because we know\n      // that \"zh-cn\" will come before \"zh-tw\", and that's what we want to match for \"zh\".\n      else if (!subLocaleMatch && subLocale === l.split('-')[0]) {\n        subLocaleMatch = l;\n      }\n    }\n\n    if (!exactLocaleMatch) {\n      if (!subLocaleMatch) {\n        DEBUG_WARN('missing momentjs locale:', locale, '; falling back to English');\n      }\n      else {\n        DEBUG_WARN('missing momentjs locale:', locale, '; using sublocale match:', subLocaleMatch);\n      }\n    }\n\n    return exactLocaleMatch || subLocaleMatch || 'en';\n  }\n\n  /**\n   * Event handler for the \"buy speed boost\" button click.\n   */\n  function buySpeedBoostClick() {\n    if (g_lastState !== 'connected') {\n      showNoticeModal(\n        'psicash#mustconnect-modal#title',\n        'psicash#mustconnect-modal#body',\n        'info',\n        null, null,\n        function() {\n          switchToTab('#connection-tab');\n        }\n      );\n      return;\n    }\n\n    const distinguisher = $(this).data('distinguisher');\n    const expectedPrice = $(`.js-psicash-sb-price[data-distinguisher=\"${distinguisher}\"]`).data('expectedPrice');\n\n    // Set the purchase-in-progress state and update UI.\n    PsiCashStore.set('purchaseInProgress', true);\n    psiCashUIUpdater();\n    psicashUIWaitState(true, '#psicash-ui-overlay-buying-boost');\n\n    HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandPurchase(\n      'speed-boost', distinguisher, expectedPrice))\n      .then((result) => {\n        // Clear the purchase-in-progress state and update UI.\n        psicashUIWaitState(false);\n        PsiCashStore.set('purchaseInProgress', false);\n        if (result.refresh) {\n          // The reponse supplied refresh data\n          psiCashUIUpdater(result.refresh);\n        }\n        else {\n          // We need to do a full refresh\n          HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('purchase-response'));\n        }\n\n        if (result.error) {\n          // Catastrophic failure. Show a modal error and hope the user can figure it out.\n          showNoticeModal(\n            'psicash#transaction-error-title',\n            'psicash#transaction-error-body',\n            'error',\n            'general#notice-modal-tech-preamble',\n            result.error,\n            null); // callback\n        }\n        else {\n          switch (result.status) {\n            case PsiCashServerResponseStatus.ExistingTransaction:\n              // There's an existing transaction that this purchase attempt conflicts with.\n              // This is a weird state, since a non-expired purchase should have prevented\n              // the purchase attempt in the first place. Hopefully the attempt request has\n              // corrected our clock skew with the server, and now the existing purchase\n              // will be indicated correctly.\n              showNoticeModal(\n                'psicash#transaction-ExistingTransaction-title',\n                'psicash#transaction-ExistingTransaction-body',\n                'warning',\n                null,  // tech detail preamble\n                null,  // tech detail body\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.InsufficientBalance:\n              // The user doesn't have enough credit to make this purchase. This is unusual,\n              // as we don't allow the user to have make a purchase that they can't afford.\n              // It can happen if the user has local \"optimistic\" credit that hasn't cleared\n              // on the server, or if the user's balance has changed elsewhere. (But we\n              // don't actually have optimistic balance usage in the Windows client yet.)\n              showNoticeModal(\n                'psicash#transaction-InsufficientBalance-title',\n                'psicash#transaction-InsufficientBalance-body',\n                'warning',\n                null,  // tech detail preamble\n                null,  // tech detail body\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.TransactionAmountMismatch:\n              // The price that we thought the purchase cost is different from what the server\n              // thinks it costs. We'll need a data refresh to get new prices.\n              showNoticeModal(\n                'psicash#transaction-TransactionAmountMismatch-title',\n                'psicash#transaction-TransactionAmountMismatch-body',\n                'warning',\n                null,  // tech detail preamble\n                null,  // tech detail body\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.TransactionTypeNotFound:\n              // The kind of thing we try tried to buy doesn't exist on the server. This is\n              // very unlikely to happen, except maybe for very old clients.\n              showNoticeModal(\n                'psicash#transaction-TransactionTypeNotFound-title',\n                'psicash#transaction-TransactionTypeNotFound-body',\n                'warning',\n                null,  // tech detail preamble\n                null,  // tech detail body\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.InvalidTokens:\n              // The tokens we tried to use were not accepted by the server.\n\n              if (g_PsiCashData.is_account) {\n                // This can occur if the account's tokens have expired since the last\n                // RefreshState. It's unusual (because token expiry is long), but not\n                // unexpected or erroneous.\n                showNoticeModal(\n                  'psicash#transaction-InvalidTokens-title',\n                  'psicash#transaction-InvalidTokens-body-account',\n                  'warning',\n                  null,  // tech detail preamble\n                  null,  // tech detail body\n                  null); // callback\n              }\n              else {\n                // This shouldn't happen for Trackers, barring DB replication lag. It\n                // suggests datastore corruption, or a bad server problem.\n                showNoticeModal(\n                  'psicash#transaction-InvalidTokens-title',\n                  'psicash#transaction-InvalidTokens-body-tracker',\n                  'error',\n                  null,  // tech detail preamble\n                  null,  // tech detail body\n                  null); // callback\n              }\n\n              // We will refresh in either case. If we're an account, it should put us into\n              // a logged-out state. If we're a tracker... it might help.\n              HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('invalid-tokens'));\n              break;\n\n            case PsiCashServerResponseStatus.ServerError:\n              // The server gave a 500-ish error\n              showNoticeModal(\n                'psicash#transaction-ServerError-title',\n                'psicash#transaction-ServerError-body',\n                'error',\n                null,  // tech detail preamble\n                null,  // tech detail body\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.Success:\n              // The purchase succeeded. We need to reconnect to apply the authorization.\n              displayCornerAlert($('#psicash-buyspeedboost-purchase-complete'));\n              // We don't need to explicitly reconnect here, as the PsiCash data refresh\n              // will detect the need for one and do it.\n              break;\n\n            default:\n              throw new Error('Unknown PsiCashServerResponseStatus received: ' + result.status);\n          }\n        }\n      });\n  }\n  $('.psicash-buy-speedboost').click(buySpeedBoostClick);\n\n\n  /**\n   * Event handler for the \"buy PsiCash with real money\" button click.\n   */\n  function buyPsiClick(e) {\n    if (e) {\n      e.preventDefault();\n    }\n\n    if (g_lastState !== 'connected') {\n      showNoticeModal(\n        'psicash#mustconnect-modal#title',\n        'psicash#mustconnect-modal#body',\n        'info',\n        null, null,\n        function() {\n          switchToTab('#connection-tab');\n        }\n      );\n      return;\n    }\n\n    if (!buyPsiClick.skipAccountEncouragement && !g_PsiCashData.is_account) {\n      // We're showing a modal encouraging PsiCash account signup. The user can either\n      // choose to launch the sign-up process, or can continue on.\n      $('#PsiCashAccountEncouragement').modal('show');\n      switchToTab('#psicash-tab');\n      return;\n    }\n\n    buyPsiClick.skipAccountEncouragement = false;\n\n    window.location = $('a.psicash-buy-psi').prop('href');\n  }\n  $('a.psicash-buy-psi').click(buyPsiClick);\n\n  /**\n   * An encouragement to \"sign up for a PsiCash account\" is shown when the user attempts\n   * to buy PsiCash without an active account. These are handlers for its buttons.\n   */\n  $('#PsiCashAccountEncouragement .js-submit-button').on('click', (e) => {\n    e.preventDefault();\n    $('#PsiCashAccountEncouragement').modal('hide').one('hidden', () => {\n      psicashAccountLogin();\n    });\n  });\n  $('#PsiCashAccountEncouragement .js-cancel-button').on('click', (e) => {\n    e.preventDefault();\n    buyPsiClick.skipAccountEncouragement = true;\n    $('#PsiCashAccountEncouragement').modal('hide').one('hidden', () => {\n      buyPsiClick();\n    });\n  });\n\n  /**\n   * Format a numeric amount of PsiCash, for display in the UI.\n   * @param {!number} nanopsi The amount of PsiCash, in nanopsi.\n   * @returns {!string} The formatted PsiCash value.\n   */\n  function formatPsi(nanopsi) {\n    if (!_.isNumber(nanopsi)) {\n      nanopsi = parseInt(nanopsi);\n    }\n\n    var BILLION = 1e9;\n\n    var currLang = $('html').attr('lang');\n\n    // NOTE: If you're testing in Chrome, toLocaleString will behave differently than in IE.\n    // For example, in Chrome locale='ar' doesn't seem to result in any change, but\n    // locale='ar-EG' does. In IE11 they both do.\n\n    var psi = nanopsi / BILLION;\n    // Reduce to two decimal places for display\n    psi = Math.floor(psi * 100) / 100;\n    // Localize number\n    try {\n      psi = psi.toLocaleString(currLang);\n    }\n    catch (e) {\n      // Our test locales (like devltr) are not valid and will cause an exception.\n      // Just fall back to English.\n      psi = psi.toLocaleString('en');\n    }\n\n    // Old IE seems to always localize to English, with `.00` suffix. We want to strip off\n    // that suffix.\n    if (psi.substring(psi.length - '.00'.length) === '.00') {\n      psi = psi.substring(0, psi.length - '.00'.length);\n    }\n\n    return psi;\n  }\n\n  /**\n   * Begin the account login flow (show the login modal).\n   * Should not be called if the user is already logged in.\n   * @param {?Event} event\n   */\n  function psicashAccountLogin(event) {\n    if (event) {\n      event.preventDefault();\n    }\n\n    if (g_lastState !== 'connected') {\n      // We're not connected, so no PsiCash ops are allowed. Switch to the connection tab.\n      showNoticeModal(\n        'psicash#mustconnect-modal#title',\n        'psicash#mustconnect-modal#body',\n        'info',\n        null, null,\n        function() {\n          switchToTab('#connection-tab');\n        }\n      );\n      return;\n    }\n\n    // Clear any input error state\n    $('#PsiCashAccountLogin .control-group').removeClass('error');\n\n    // Show the login modal\n    $('#PsiCashAccountLogin').modal({\n      show: true,\n      backdrop: 'static'\n    }).one('shown', function () {\n      $('#AccountUsername').trigger('focus');\n    }).one('hidden', function () {\n      // The modal has closed; clear the password field\n      $('#PsiCashAccountLogin #AccountPassword').val('');\n\n      // We're purposely not clearing the username field. It's less sensitive (if the user\n      // logs in successfully it will be stored and displayed) and it will be helpful to\n      // the user to not have to type it in again if the login attempt fails.\n    });\n  }\n  $('.js-account-login').on('click', psicashAccountLogin);\n\n  /**\n   * Handler for the login dialog submit event.\n   * @param {Event} event\n   */\n  function psicashAccountLoginSubmitHandler(event) {\n    if (event) {\n      event.preventDefault();\n    }\n\n    if (g_lastState !== 'connected') {\n      // We're not connected, so no PsiCash ops are allowed. Close the login modal and\n      // switch to the connection tab.\n      $('#PsiCashAccountLogin').modal('hide').one('hidden', function () {\n        showNoticeModal(\n          'psicash#mustconnect-modal#title',\n          'psicash#mustconnect-modal#body',\n          'info',\n          null, null,\n          function() {\n            switchToTab('#connection-tab');\n          }\n        );\n      });\n      return;\n    }\n\n    const username = $('#AccountUsername').val();\n    const password = $('#AccountPassword').val();\n\n    // Validate input (make sure the fields aren't blank)\n    $('#AccountUsername').parents('.control-group').toggleClass('error', !username);\n    $('#AccountPassword').parents('.control-group').toggleClass('error', !password);\n    if (!username || !password) {\n      $(!username ? '#AccountUsername' : '#AccountPassword').trigger('focus');\n      return;\n    }\n\n    // We're going to dismiss the login modal before attempting login. This is partly\n    // so that we don't complicate the UI state and partly because modals-over-modals\n    // gets crash-y.\n    $('#PsiCashAccountLogin').modal('hide');\n\n    // Show the \"login in progress UI overlay\"\n    psicashUIWaitState(true, '#psicash-ui-overlay-logging-in');\n\n    HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandLogin(username, password))\n      .then((result) => {\n\n        // In the success case we want to maintain the wait state until after a refresh.\n        // In all other cases we drop it now.\n        if (result.status !== PsiCashServerResponseStatus.Success) {\n          psicashUIWaitState(false, null);\n        }\n\n        if (result.refresh) {\n          // The reponse supplied refresh data.\n          // Note that this will be incomplete -- no balance or purchases -- we still need\n          // to do a full refresh, below.\n          psiCashUIUpdater(result.refresh);\n        }\n        else {\n          // We need to do a full refresh\n          HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('account-login'));\n        }\n\n        if (result.error) {\n          // Catastrophic failure. Hopefully the error string helps the user diagnose the problem.\n          showNoticeModal(\n            'psicash#login#failure-modal-title',\n            'psicash#login#catastrophic-error-body',\n            'error',\n            'general#notice-modal-tech-preamble',\n            result.error,\n            null); // callback\n        }\n        else {\n          switch (result.status) {\n            case PsiCashServerResponseStatus.InvalidCredentials:\n              showNoticeModal(\n                'psicash#login#failure-modal-title',\n                'psicash#login#invalid-credentials-body',\n                'warning',\n                null,  // tech preamble\n                null,  // tech detail\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.BadRequest:\n              // The request was malformed in some way. This shouldn't happen.\n              showNoticeModal(\n                'psicash#login#failure-modal-title',\n                'psicash#login#badrequest-error-body',\n                'error',\n                null,  // tech preamble\n                null,  // tech detail\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.ServerError:\n              // The server gave a 500-ish error\n              showNoticeModal(\n                'psicash#login#failure-modal-title',\n                'psicash#login#server-error-body',\n                'error',\n                null,  // tech preamble\n                null,  // tech detail\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.Success:\n              // Account login succeeded.  hard refresh is required.\n              if (result.last_tracker_merge) {\n                showNoticeModal(\n                  'psicash#login#success-modal-title',\n                  'psicash#login#last-tracker-merge-body',\n                  'success',\n                  null,  // tech preamble\n                  null,  // tech detail\n                  null); // callback\n              }\n\n              // Don't clear the wait state until the refresh is complete, since we're not\n              // really \"ready\" until then.\n              HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('new-login')).then(() => {\n                psicashUIWaitState(false, null);\n              });\n              break;\n\n            default:\n              throw new Error('Login: unknown PsiCashServerResponseStatus received: ' + result.status);\n          }\n        }\n      });\n  }\n  $('#PsiCashAccountLogin .js-submit-button').on('click', psicashAccountLoginSubmitHandler);\n  $('#PsiCashAccountLogin input').on('keyup', function (event) {\n    if (event.key === 'Enter' || event.keyCode === 13) {\n      psicashAccountLoginSubmitHandler();\n    }\n  });\n\n  /**\n   * Begin the account logout flow. Should not be called if the user is not logged in.\n   * @param {?Event} event\n   */\n  function psicashAccountLogout(event) {\n    if (event) {\n      event.preventDefault();\n    }\n\n    if (g_lastState !== 'connected') {\n      showNoticeModal(\n        'psicash#mustconnect-modal#title',\n        'psicash#mustconnect-modal#body',\n        'info',\n        null, null,\n        function () {\n          switchToTab('#connection-tab');\n        }\n      );\n      return;\n    }\n\n    psicashUIWaitState(true, '#psicash-ui-overlay-logging-out');\n\n    HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandLogout())\n      .then((result) => {\n        psicashUIWaitState(false, null);\n\n        if (result.refresh) {\n          // The reponse supplied refresh data\n          psiCashUIUpdater(result.refresh);\n        }\n\n        if (result.error) {\n          // Catastrophic failure. Show a modal error and hope the user can figure it out.\n          showNoticeModal(\n            'psicash#modal-logout-header',\n            'psicash#modal-logout-error-body',\n            'error',\n            'general#notice-modal-tech-preamble',\n            result.error,\n            null); // callback\n        }\n        else {\n          // Note that tunnel reconnection may be necessary to clear any active\n          // authorizations (like Speed Boost), but that will be handled by the\n          // PsiCash data refresh.\n          HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('logout'));\n        }\n      });\n  }\n  $('.js-account-logout').on('click', psicashAccountLogout);\n\n  /**\n   *\n   * @param {boolean} start True if the wait state is starting, false if it should be cleared.\n   * @param {*} messageSelector The selector of the message that should be shown during the wait state. May be null if the wait state is ending.\n   */\n  function psicashUIWaitState(start, messageSelector) {\n    if (messageSelector) {\n      $('.js-psicash-ui-overlay-messages > *').not(messageSelector).addClass('hidden');\n      $(messageSelector).removeClass('hidden');\n    }\n\n    $('.psicash-ui-overlay, .psicash-block-overlay').toggleClass('hidden', !start);\n  }\n\n  /**\n   * Called when tunnel core indicates that there was an attempt to access a\n   * port disallowed by the current traffic rules. We will show an alert to\n   * encourage the user to buy Speed Boost.\n   */\n  function handleDisallowedTrafficNotice() {\n    if (PsiCashStore.data.uiState === PsiCashUIState.ACTIVE_BOOST) {\n      // If we're boosting, then any disallowed traffic is something that won't\n      // be let through by purchasing speed boost, so logging, etc., is pointless.\n      DEBUG_LOG('handleDisallowedTrafficNotice: already boosting');\n      return;\n    }\n\n    addLog({\n      priority: 2, // high\n      message: 'Disallowed traffic detected; please purchase Speed Boost'\n    });\n\n    if (g_initObj.Settings.DisableDisallowedTrafficAlert) {\n      // User has disabled this alert in the settings\n      DEBUG_LOG('handleDisallowedTrafficNotice: DisableDisallowedTrafficAlert is true');\n      return;\n    }\n\n    if (!handleDisallowedTrafficNotice.alertDisallowedTraffic) {\n      // We have already shown the alert this session.\n      DEBUG_LOG('handleDisallowedTrafficNotice: alert already shown this session');\n      return;\n    }\n    // else show the alert\n\n    DEBUG_LOG('handleDisallowedTrafficNotice: showing alert');\n\n    handleDisallowedTrafficNotice.alertDisallowedTraffic = false;\n\n    HtmlCtrlInterface_DisallowedTraffic();\n\n    showNoticeModal(\n      'notice#disallowed-traffic-alert-title',\n      'notice#disallowed-traffic-alert-body',\n      'info',\n      null, null, () => {\n        if (!$('#psicash-tab').hasClass('hidden')) {\n          switchToTab('#psicash-tab');\n        }\n\n        /* Before we had the PsiCash pane, we would wiggle the bottom-left PsiCash block.\n        We'll leave this code in for now in case we decide that we prefer it.\n        if (compareIEVersion('gte', 9, true)) {\n          const psicashBlock = $('#psicash-block');\n          if (!psicashBlock.hasClass('hidden')) {\n            $('#psicash-block').addClass('draw-attention');\n            // The animation is 1s of movement, and we want the effect to linger for a bit.\n            setTimeout(() => $('#psicash-block').removeClass('draw-attention'), 1500);\n          }\n        }\n        */\n      });\n  }\n  handleDisallowedTrafficNotice.alertDisallowedTraffic = true;\n  $window.on(CONNECTED_STATE_CHANGE_EVENT, () => {\n    if (g_lastState === 'stopped') {\n      // After a hard stop, we will again show the \"disallowed traffic\" alert one time.\n      DEBUG_LOG('handleDisallowedTrafficNotice: resetting alertDisallowedTraffic to true because connected state stopped');\n      handleDisallowedTrafficNotice.alertDisallowedTraffic = true;\n    }\n  });\n  PsiCashStore.subscribe('uiState', () => {\n    if (PsiCashStore.data.uiState === PsiCashUIState.ACTIVE_BOOST &&\n        !handleDisallowedTrafficNotice.boosting) {\n      DEBUG_LOG('handleDisallowedTrafficNotice: boost started');\n      handleDisallowedTrafficNotice.boosting = true;\n    }\n    else if (handleDisallowedTrafficNotice.boosting) {\n      // We were boosting and now we're not. Show the \"disallowed traffic\" alert again.\n      DEBUG_LOG('handleDisallowedTrafficNotice: resetting alertDisallowedTraffic to true because boost ended');\n      handleDisallowedTrafficNotice.boosting = false;\n      handleDisallowedTrafficNotice.alertDisallowedTraffic = true;\n    }\n  });\n\n  /* UI HELPERS ****************************************************************/\n\n  function displayCornerAlert(elem) {\n    nextTick(() => {\n      // Show -- and then hide -- the alert\n      const appearAnimationTime = 500;\n      const showingTime = 4000;\n      const disappearAnimationTime = 1000;\n      // NOTE: Many of the JqueryUI animation effects don't work well with DPI scaling --\n      // they end up floating in the middle of the window, or jumping around, or hidden.\n      // The 'fade' effect is one of the few that is okay, but it's not really the visual\n      // we want. However, not supply an explicit effect provides a default that works and\n      // looks pretty good. I was unable to figure out which named effect it corresponds\n      // to (I didn't go looking in the jQueryUI source code, though).\n      $(elem).toggle({\n        duration: appearAnimationTime,\n        complete: () => {\n          setTimeout(function() {\n            $(elem).toggle({duration: disappearAnimationTime});\n          }, showingTime);\n        }\n      });\n    });\n  }\n\n  // Make the given tab visible. `tab` may be a selector, a DOM element, or a\n  // jQuery object. If `callback` is provided, it will be invoked when tab is shown.\n  function switchToTab(tab, callback) {\n    var $tab = $(tab);\n    if ($tab.hasClass('active')) {\n      // Target tab already showing.\n      if (callback) {\n        nextTick(callback);\n      }\n    }\n    else {\n      // Target tab not already showing. Switch to it before expanding and scrolling.\n      if (callback) {\n        $tab.find('[data-toggle=\"tab\"]').one('show', callback);\n      }\n      $tab.find('[data-toggle=\"tab\"]').tab('show');\n    }\n  }\n\n  /**\n   * Shows a modal box. String table keys will be used for filling in the content.\n   * The \"tech\" values are optional.\n   * @param {!string} titleKey\n   * @param {!string} bodyKey\n   * @param {?string} levelIcon optional; must be one of \"error\", \"warning\", \"info\", \"success\"\n   * @param {?string} techPreambleKey\n   * @param {?string} techInfoString An explicit string -- not a string table key.\n   * @param {?callback} closedCallback Optional and will be called when the modal is closed.\n   */\n  function showNoticeModal(titleKey, bodyKey, levelIcon, techPreambleKey, techInfoString, closedCallback) {\n    DEBUG_ASSERT(titleKey && bodyKey, 'missing titleKey or bodyKey', titleKey, bodyKey);\n\n    var $modal = $('#NoticeModal');\n\n    $modal.find('.js-modal-title').html(i18n.t(titleKey));\n    $modal.find('.js-notice-modal-body').html(i18n.t(bodyKey));\n\n    $modal.find('.paragraph-icon').addClass('hidden');\n    if (levelIcon) {\n      $modal.find(`.paragraph-icon__${levelIcon}`).removeClass('hidden');\n    }\n\n    if (techPreambleKey && techInfoString) {\n      $modal.find('.js-notice-modal-tech-preamble').html(i18n.t(techPreambleKey));\n      $modal.find('.js-notice-modal-tech-info').text(techInfoString);\n      $modal.find('.js-notice-modal-tech').removeClass('hidden');\n    }\n    else {\n      $modal.find('.js-notice-modal-tech').addClass('hidden');\n    }\n\n    // Put up the modal\n    $modal.modal({\n      show: true,\n      backdrop: 'static'\n    }).one('hidden', function() {\n      if (closedCallback) {\n        closedCallback();\n      }\n    });\n  }\n\n  /* MISC HELPERS AND UTILITIES ************************************************/\n\n  // Support the `data-match-height` feature.\n  function doMatchHeight() {\n    var i, j, $elem, matchSelector, matchSelectorsToMaxHeight = {}, $matchSelectorMatches;\n    var $elemsToChange = $('[data-match-height]');\n\n    //\n    // Reset previously adjusted heights; record the match selectors.\n    //\n    for (i = 0; i < $elemsToChange.length; i++) {\n      $elem = $elemsToChange.eq(i);\n\n      // Store the original padding, if we don't already have it.\n      if (_.isUndefined($elem.data('match-height-orig-padding-top'))) {\n        $elem.data('match-height-orig-padding-top', parseInt($elem.css('padding-top')))\n             .data('match-height-orig-padding-bottom', parseInt($elem.css('padding-bottom')));\n      }\n\n      // Reset the padding to its original state\n      $elem.css('padding-top', $elem.data('match-height-orig-padding-top'))\n           .css('padding-bottom', $elem.data('match-height-orig-padding-bottom'));\n\n      matchSelector = $elem.data('match-height');\n      matchSelectorsToMaxHeight[matchSelector] = null;\n    }\n\n    //\n    // Alter the heights.\n    //\n    for (i = 0; i < $elemsToChange.length; i++) {\n      $elem = $elemsToChange.eq(i);\n      matchSelector = $elem.data('match-height');\n\n      // If we haven't already determined the max for this selector, calculate it\n      if (matchSelectorsToMaxHeight[matchSelector] === null) {\n        $matchSelectorMatches  = $(matchSelector);\n        for (j = 0; j < $matchSelectorMatches.length; j++) {\n          matchSelectorsToMaxHeight[matchSelector] = Math.max(\n            matchSelectorsToMaxHeight[matchSelector],\n            $matchSelectorMatches.eq(j).height());\n        }\n      }\n\n      // Alter the height.\n      matchHeight($elem, matchSelectorsToMaxHeight[matchSelector]);\n    }\n\n    function matchHeight($elem, height) {\n      var heightDiff = height - $elem.height();\n      if (heightDiff <= 0) {\n        // Already at least big enough\n        return;\n      }\n\n      var align = $elem.data('match-height-align');\n      if (align === 'top') {\n        $elem.css('padding-bottom', heightDiff + $elem.data('match-height-orig-padding-bottom'));\n      }\n      else if (align === 'bottom') {\n        $elem.css('padding-top', heightDiff + $elem.data('match-height-orig-padding-top'));\n      }\n      else { // center\n        $elem.css('padding-top', heightDiff/2 + $elem.data('match-height-orig-padding-top'))\n             .css('padding-bottom', heightDiff/2 + $elem.data('match-height-orig-padding-bottom'));\n      }\n    }\n  }\n\n  // Support the `data-match-width` feature\n  function doMatchWidth() {\n    var matchSelectors = [], $dataMatchElems, $elem,\n        matchSelector, $matchMaxElems, matchSelectorMaxWidth, i, j;\n\n    $dataMatchElems = $('[data-match-width]');\n\n    // First reset the widths of all the elements we will be adjusting. Otherwise\n    // the find-max-width will be tainted if an element-to-adjust is also part of\n    // of the find-max-width selector.\n    for (i = 0; i < $dataMatchElems.length; i++) {\n      $elem = $dataMatchElems.eq(i);\n      $elem.css('width', '');\n\n      // Build up a list of the selectors used, with dependent ones at the end.\n      matchSelector = $elem.data('match-width');\n      if (!_.includes(matchSelectors, matchSelector)) {\n        if ($elem.data('match-width-dependent') === 'true') {\n          matchSelectors.push(matchSelector);\n        }\n        else {\n          matchSelectors.unshift(matchSelector);\n        }\n      }\n    }\n\n    // Then collect the maximums for each of the selectors provided by data-match-width\n    for (i = 0; i < matchSelectors.length; i++) {\n      matchSelector = matchSelectors[i];\n\n      matchSelectorMaxWidth = 0.0;\n      $matchMaxElems = $(matchSelector);\n      for (j = 0; j < $matchMaxElems.length; j++) {\n        matchSelectorMaxWidth = Math.max(\n                                  matchSelectorMaxWidth,\n                                  $matchMaxElems.eq(j).outerWidth());\n      }\n\n      // Apply the max width to the target elements.\n      $dataMatchElems = $('[data-match-width=\"' + matchSelector + '\"]');\n      for (j = 0; j < $dataMatchElems.length; j++) {\n        $elem = $dataMatchElems.eq(j);\n        $elem.width(getNetWidth($elem, matchSelectorMaxWidth));\n      }\n    }\n\n    function getNetWidth($elem, grossWidth) {\n      return grossWidth -\n              (parseFloat($elem.css('padding-right')) || 0) -\n              (parseFloat($elem.css('padding-left')) || 0) -\n              (parseFloat($elem.css('border-right-width')) || 0) -\n              (parseFloat($elem.css('border-left-width')) || 0) -\n              (parseFloat($elem.css('margin-right')) || 0) -\n              (parseFloat($elem.css('margin-left')) || 0);\n    }\n  }\n\n  function getIEVersion() {\n    // This is complicated by the fact that the MSHTML control uses a different\n    // user agent string than browsers do.\n\n    var ie7_10Match, ie11Match, edgeMatch, tridentMatch, msieMatch;\n\n    var ieVersion = false;\n\n    // User agents differ between browser and actual application, so we need\n    // different checks\n\n    if (IS_BROWSER) {\n      // Some care needs to be taken to work with IE11+'s old-version test mode.\n      // We can't just use Trident versions.\n\n      // This will match IEv7-10.\n      ie7_10Match = window.navigator.userAgent.match(/^Mozilla\\/\\d\\.0 \\(compatible; MSIE (\\d+)/);\n      // This will match IE11.\n      ie11Match = window.navigator.userAgent.match(/Trident\\/(\\d+)/);\n      // This will match Edgev1 (which we will consider IE12).\n      edgeMatch = window.navigator.userAgent.match(/Edge\\/(\\d+)/);\n\n      if (ie7_10Match) {\n        ieVersion = parseInt(ie7_10Match[1]);\n      }\n      else if (ie11Match) {\n        // Trident version is 4 versions behind IE version.\n        ieVersion = parseInt(ie11Match[1]) + 4;\n      }\n      else if (edgeMatch) {\n        ieVersion = parseInt(edgeMatch[1]);\n      }\n    }\n    else {\n      // This will match MSHTMLv8-11.\n      tridentMatch = window.navigator.userAgent.match(/MSIE \\d+.*Trident\\/(\\d+)/);\n      // This will match MSHTMLv7. Note that it must be checked after the Trident match.\n      msieMatch = window.navigator.userAgent.match(/MSIE (\\d+)/);\n\n      // This will match Edgev1 (which we will consider IE12).\n      // Note that this hasn't been seen in the Wild. MSHTML on Win10 uses Trident/8,\n      // which hits the above regex and returns version 12.\n      edgeMatch = window.navigator.userAgent.match(/Edge\\/(\\d+)/);\n\n      if (tridentMatch) {\n        // Trident version is 4 versions behind IE version.\n        ieVersion = parseInt(tridentMatch[1]) + 4;\n      }\n      else if (msieMatch) {\n        ieVersion = parseInt(msieMatch[1]);\n      }\n      else if (edgeMatch) {\n        ieVersion = parseInt(edgeMatch[1]);\n      }\n    }\n\n    return ieVersion;\n  }\n\n  // `comparison` may be: 'eq', 'lt', 'gt', 'lte', 'gte'\n  function compareIEVersion(comparison, targetVersion, acceptNonIE) {\n    var ieVersion = getIEVersion();\n\n    if (ieVersion === false) {\n      return acceptNonIE;\n    }\n\n    if (comparison === 'eq') {\n      return ieVersion == targetVersion;\n    }\n    else if (comparison === 'lt') {\n      return ieVersion < targetVersion;\n    }\n    else if (comparison === 'gt') {\n      return ieVersion > targetVersion;\n    }\n    else if (comparison === 'lte') {\n      return ieVersion <= targetVersion;\n    }\n    else if (comparison === 'gte') {\n      return ieVersion >= targetVersion;\n    }\n\n    return false;\n  }\n\n  //\n  // We don't have the ability to use real cookies or DOM storage, so we'll store\n  // persistent stuff in the registry via the win32 code.\n  //\n  var g_cookies = g_initObj.Cookies ? JSON.parse(g_initObj.Cookies) : {};\n\n  /**\n   * Retrieves the stored cookie value associated with `name`.\n   * @param {string} name\n   * @returns {} The value for `name`. May be null or undefined.\n   */\n  function getCookie(name) {\n    if (IS_BROWSER) {\n      const localVal = JSON.parse(window.localStorage.getItem(name));\n      if (!_.isUndefined(localVal) & localVal !== null) {\n        return localVal;\n      }\n      return g_cookies[name];\n    }\n\n    return g_cookies[name];\n  }\n\n  /**\n   * Persistently stores `value` under the key `name`.\n   * @param {string} name The key to store the `value` under.\n   * @param {} value The value to be stored. Must be JSON-able.\n   */\n  function setCookie(name, value) {\n    if (IS_BROWSER) {\n      window.localStorage.setItem(name, JSON.stringify(value));\n    }\n\n    g_cookies[name] = value;\n    HtmlCtrlInterface_SetCookies(JSON.stringify(g_cookies));\n  }\n\n\n  // Sets a short timeout and then calls `callback`\n  // `context` is optional. Will be `this` when `callback` is called.\n  function nextTick(callback, context) {\n    nextTickFn(callback, context)();\n  }\n\n  // Creates a function that, when called, sets a short timeout and then calls `callback`\n  // `context` is optional. Will be `this` when `callback` is called.\n  function nextTickFn(callback, context) {\n    return function nextTickFnInner() {\n      var args = arguments;\n      var runner = function() {\n        callback.apply(context, args);\n      };\n\n      setTimeout(runner, 0);\n    };\n  }\n\n  // Convert hex-style color (#FFFFFF or #FFF) to RGB style (rgb(255, 255, 255)).\n  // From http://stackoverflow.com/a/5624139/729729\n  function hexToRgb(hex) {\n    // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n    var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n    hex = hex.replace(shorthandRegex, function(m, r, g, b) {\n      return r + r + g + g + b + b;\n    });\n\n    var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    return result ? {\n      r: parseInt(result[1], 16),\n      g: parseInt(result[2], 16),\n      b: parseInt(result[3], 16)\n    } : null;\n  }\n\n  // Draws attention to a button. Note that this may require some extra styling\n  // to fully work (so test accordingly).\n  function drawAttentionToButton(elem) {\n    // We will draw attention by temporarily flaring a box-shadow, and then\n    // wiggling the button. The wiggle comes from CSS animation (see main.less).\n\n    var backgroundColor, backgroundColorRGB, shadowColor;\n    var $elem = $(elem);\n\n    var originalBoxShadow = $elem.data('drawAttentionToButton-originalBoxShadow');\n    if (!originalBoxShadow) {\n      originalBoxShadow = $elem.css('box-shadow');\n      $elem.data('drawAttentionToButton-originalBoxShadow', originalBoxShadow);\n    }\n\n    // The box shadow will be same colour as the button background, with reduced\n    // opacity.\n\n    backgroundColor = $elem.css('background-color');\n    if (!backgroundColor) {\n      backgroundColor = '#999';\n    }\n\n    if (backgroundColor[0] === '#') {\n      // hex style; convert to rgb\n      backgroundColorRGB = hexToRgb(backgroundColor);\n      backgroundColor = 'rgb(' + backgroundColorRGB.r + ', ' +\n                                 backgroundColorRGB.g + ', ' +\n                                 backgroundColorRGB.b + ')';\n    }\n\n    // Only add alpha if this is a rgb(..) colour, and not rgba(...) or anything else.\n    if (backgroundColor.slice(0, 4) === 'rgb(') {\n      shadowColor = 'rgba(' + backgroundColor.slice(4, -1) + ', 0.7)';\n    }\n    else {\n      shadowColor = backgroundColor;\n    }\n\n    // The effect we're going for is the color draining from outside into the button.\n    var animationTimeSecs = 3;\n\n    // Add the initial internal and external shadow\n    $elem.css({\n      'transition': '',\n      'box-shadow': 'inset 0 0 100px #FFF, 0 0 10px ' + shadowColor\n    });\n\n    // After giving that CSS change a moment to take effect...\n    _.delay(function() {\n      // ...add a transition and remove the box shadow. It will disappear slowly.\n      $elem.css({\n        'transition': 'box-shadow ' + animationTimeSecs + 's',\n        'box-shadow': 'none'\n      });\n\n      // When the big box shadow is gone, reset to the original value\n      $elem.one('transitionend', function() {\n        $elem.css({\n          'transition': '',\n          'box-shadow': originalBoxShadow\n        });\n      });\n    }, 10); // if this is too low, the effect seems to fail sometimes (like when a port number field is changed in settings)\n  }\n\n  function DEBUG_ASSERT(check) {\n    if (g_initObj.Config.Debug) {\n      if (_.isFunction(check)) {\n        check = check();\n      }\n\n      if (!check) {\n        let message = 'DEBUG_ASSERT failed: ' + check + '; args: \\n';\n        for (let i = 1; i < arguments.length; i++) {\n          message += '\\t' + arguments[i] + '\\n';\n        }\n        throw new Error(message);\n      }\n    }\n  }\n\n  /**\n   * Returns true if the windows currently has focus; false otherwise.\n   * @returns {boolean}\n   */\n  function windowHasFocus() {\n    return document.hasFocus();\n  }\n\n  /**\n   * Adds a handler that will be called when the windows gets focus.\n   * @param {function} handler\n   */\n  function addWindowFocusHandler(handler) {\n    $window.on('focus', handler);\n  }\n\n  /**\n   * Generates a pseudo-random string, suitable for non-crypto uniqueness.\n   * @returns {string}\n   */\n  function randomID() {\n    return base64.encode(Math.random());\n  }\n\n  /**\n   * Splits the given URL into components that can be accessed with `result.hash`, etc.\n   * @param {string} url\n   * @returns {HTMLAnchorElement}\n   */ /* unused\n  function urlComponents(url) {\n    const parser = document.createElement('a');\n    parser.href = url;\n    return parser;\n  }*/\n\n\n  /* DEBUGGING *****************************************************************/\n\n  // Some functionality to help us debug (and demo) in browser.\n\n  $(function debugInit() {\n    if (!g_initObj.Config.Debug) {\n      $('#debug-tab, #debug-pane').remove();\n      return;\n    }\n\n    // Make the connect button \"work\" in browser mode\n    $('#connect-toggle a').click(function(e) {\n      if (!IS_BROWSER) {\n        return;\n      }\n\n      e.preventDefault();\n      var buttonConnectState = $(this).parents('.connect-toggle-content').data('connect-state');\n      if (buttonConnectState === 'stopped') {\n        console.log('DEBUG: connection starting');\n        HtmlCtrlInterface_SetState({state: 'starting'});\n        setTimeout(function() {\n          HtmlCtrlInterface_SetState({state: 'connected'});\n        }, 2000);\n      }\n      else if (buttonConnectState === 'starting' || buttonConnectState === 'connected') {\n        console.log('DEBUG: connection stopping');\n        HtmlCtrlInterface_SetState({state: 'stopping'});\n        setTimeout(function() {\n          HtmlCtrlInterface_SetState({state: 'stopped'});\n        }, 2000);\n      }\n      // the stopping button is disabled\n    });\n\n    // Keep state combo up-to-date\n    function updateStateCombo() {\n      $('#debug-state').val(g_lastState);\n    }\n    $window.on(CONNECTED_STATE_CHANGE_EVENT, updateStateCombo);\n    updateStateCombo();\n    // Change state when combo changes\n    $('#debug-state').on('change', function() {\n      HtmlCtrlInterface_SetState({state: $('#debug-state').val()});\n    });\n\n    // Wire up AddLog\n    $('#debug-log a').click(function() {\n      HtmlCtrlInterface_AddLog({\n        message: $('#debug-log input').val(),\n        priority: parseInt($('#debug-log select').val())\n      });\n    });\n\n    // Wire up the AvailableEgressRegions notice\n    $('#debug-AvailableEgressRegions a').click(function() {\n      var regions = [], regionCheckboxes = $('#debug-AvailableEgressRegions input');\n      for (var i = 0; i < regionCheckboxes.length; i++) {\n        if (regionCheckboxes.eq(i).prop('checked')) {\n          regions.push(regionCheckboxes.eq(i).val());\n        }\n      }\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'AvailableEgressRegions',\n        data: { regions: regions }\n      });\n    });\n\n    // Wire up the PsiphonUI::URLCopiedToClipboard notice\n    $('#debug-URLCopiedToClipboard a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'PsiphonUI::URLCopiedToClipboard'\n      });\n    });\n\n    // Wire up the UpstreamProxyError notice\n    $('#debug-UpstreamProxyError a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'UpstreamProxyError',\n        data: { message: $('#debug-UpstreamProxyError input').val() }\n      });\n    });\n\n    // Wire up the TrafficRateLimits notice\n    $('#debug-TrafficRateLimits a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'TrafficRateLimits',\n        data: { downstreamBytesPerSecond: Number($('#debug-TrafficRateLimits input').val()) }\n      });\n    });\n\n    // Wire up the HttpProxyPortInUse notice\n    $('#debug-HttpProxyPortInUse a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'HttpProxyPortInUse'\n      });\n    });\n\n    // Wire up the SocksProxyPortInUse notice\n    $('#debug-SocksProxyPortInUse a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'SocksProxyPortInUse'\n      });\n    });\n\n    // Wire up the SystemProxySettings::SetProxyError test\n    $('#debug-SetProxyError a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'SystemProxySettings::SetProxyError'\n      });\n    });\n\n    // Wire up the SystemProxySettings::SetProxyWarning test\n    $('#debug-SetProxyWarning a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'SystemProxySettings::SetProxyWarning',\n        data: '[CONN NAME]'\n      });\n    });\n\n    // Wire up the UpdateDpiScaling test\n    $('#debug-UpdateDpiScaling a').click(function() {\n      HtmlCtrlInterface_UpdateDpiScaling({\n        dpiScaling: $('#debug-UpdateDpiScaling input').val()\n      });\n    });\n\n    // Wire up the RefreshPsiCash test\n    $('#debug-RefreshPsiCash a').click(function debugRefreshPsiCashClick() {\n      if (!$('#debug-RefreshPsiCash-balance').val() ||\n          !$('#debug-RefreshPsiCash-price-1hr').val() ||\n          !$('#debug-RefreshPsiCash-price-24hr').val() ||\n          !$('#debug-RefreshPsiCash-price-7day').val() ||\n          !$('#debug-RefreshPsiCash-price-31day').val()) {\n        return;\n      }\n\n      const msg = makeTestRefreshMsg(null);\n      HtmlCtrlInterface_PsiCashMessage(msg);\n\n      setCookie('debug-RefreshPsiCash-balance', msg.payload.balance);\n      setCookie('debug-RefreshPsiCash-price-1hr', msg.payload.purchase_prices.length ? msg.payload.purchase_prices.find(pp => pp.distinguisher==='1hr').price : null);\n      setCookie('debug-RefreshPsiCash-price-24hr', msg.payload.purchase_prices.length ? msg.payload.purchase_prices.find(pp => pp.distinguisher==='24hr').price : null);\n      setCookie('debug-RefreshPsiCash-price-7day', msg.payload.purchase_prices.length ? msg.payload.purchase_prices.find(pp => pp.distinguisher==='7day').price : null);\n      setCookie('debug-RefreshPsiCash-price-31day', msg.payload.purchase_prices.length ? msg.payload.purchase_prices.find(pp => pp.distinguisher==='31day').price : null);\n      setCookie('debug-RefreshPsiCash-isAccount', msg.payload.is_account);\n      setCookie('debug-RefreshPsiCash-hasTokens', msg.payload.has_tokens);\n      setCookie('debug-RefreshPsiCash-accountUsername', msg.payload.account_username);\n    });\n\n    // Wire up the PsiCash InitDone test\n    $('#debug-PsiCashInitDone a').click(function debugPsiCashInitDoneClick() {\n      testInitDoneResponse();\n    });\n\n    const BILLION = 1e9;\n    // Populate the PsiCash balance, price, and account info\n    $('#debug-RefreshPsiCash-balance').val(_.isNumber(getCookie('debug-RefreshPsiCash-balance')) ? getCookie('debug-RefreshPsiCash-balance') / BILLION : '');\n    $('#debug-RefreshPsiCash-price-1hr').val(_.isNumber(getCookie('debug-RefreshPsiCash-price-1hr')) ? getCookie('debug-RefreshPsiCash-price-1hr') / BILLION : '');\n    $('#debug-RefreshPsiCash-price-24hr').val(_.isNumber(getCookie('debug-RefreshPsiCash-price-24hr')) ? getCookie('debug-RefreshPsiCash-price-24hr') / BILLION : '');\n    $('#debug-RefreshPsiCash-price-7day').val(_.isNumber(getCookie('debug-RefreshPsiCash-price-7day')) ? getCookie('debug-RefreshPsiCash-price-7day') / BILLION : '');\n    $('#debug-RefreshPsiCash-price-31day').val(_.isNumber(getCookie('debug-RefreshPsiCash-price-31day')) ? getCookie('debug-RefreshPsiCash-price-31day') / BILLION : '');\n\n    $('#debug-RefreshPsiCash-isAccount')[0].checked = getCookie('debug-RefreshPsiCash-isAccount');\n    $('#debug-RefreshPsiCash-hasTokens')[0].checked = getCookie('debug-RefreshPsiCash-hasTokens');\n    $('#debug-RefreshPsiCash-accountUsername').val(getCookie('debug-RefreshPsiCash-accountUsername') ? getCookie('debug-RefreshPsiCash-accountUsername') : '');\n\n    // Wire up the Disallowed Traffic test\n    $('#debug-DisallowedTraffic a').click(function debugPsiCashInitDoneClick() {\n      handleDisallowedTrafficNotice();\n    });\n\n  });\n\n  /**\n   * Construct a PsiCashMessageData object from the fields in the debug interface.\n   * @param {?string} msg_id The message.id to use in the \"response\".\n   * @returns {!PsiCashMessageData}\n   */\n  function makeTestRefreshMsg(msg_id) {\n    let purchase = null; /** @type {?PsiCashPurchase} */\n    if ($('#debug-RefreshPsiCash-boost-remaining').val()) {\n      purchase = {\n        id: `purchase-id-${randomID()}`,\n        'class': 'speed-boost',\n        distinguisher: '1hr',\n        authorization: 'myfakeauth',\n        localTimeExpiry: moment().add(parseFloat($('#debug-RefreshPsiCash-boost-remaining').val()), 'minutes').toISOString()\n      };\n    }\n\n    /** @type {PsiCashMessageData} */\n    let msg = {\n      type: PsiCashMessageTypeEnum.REFRESH,\n      id: msg_id,\n      payload: makeTestRefreshPayload(purchase)\n    };\n\n    return msg;\n  }\n\n  /**\n   * Create a PsiCash RefreshState payload suitable for testing\n   * @param {?PsiCashPurchase} purchase\n   * @param {?boolean} isAccount\n   * @param {?boolean} hasTokens\n   * @param {?string} accountUsername Must be set if isAccount&&hasTokens are true\n   * @returns {PsiCashRefreshData}\n   */\n  function makeTestRefreshPayload(purchase=undefined, isAccount=undefined, hasTokens=undefined, accountUsername=undefined) {\n    const BILLION = 1e9;\n\n    if (_.isUndefined(isAccount)) {\n      isAccount = $('#debug-RefreshPsiCash-isAccount')[0].checked;\n    }\n    else {\n      $('#debug-RefreshPsiCash-isAccount')[0].checked = isAccount;\n    }\n\n    if (_.isUndefined(hasTokens)) {\n      hasTokens = $('#debug-RefreshPsiCash-hasTokens')[0].checked;\n    }\n    else {\n      $('#debug-RefreshPsiCash-hasTokens')[0].checked = hasTokens;\n    }\n\n    if (_.isUndefined(accountUsername)) {\n      accountUsername = $('#debug-RefreshPsiCash-accountUsername').val();\n    }\n    else {\n      $('#debug-RefreshPsiCash-accountUsername').val(accountUsername ? accountUsername : '');\n    }\n\n    return {\n      is_account: isAccount,\n      account_username: accountUsername,\n      has_tokens: hasTokens,\n      balance: hasTokens ? parseFloat($('#debug-RefreshPsiCash-balance').val()) * BILLION : 0,\n      purchase_prices: hasTokens ? [\n        {\n          'class': 'speed-boost',\n          distinguisher: '1hr',\n          price: parseFloat($('#debug-RefreshPsiCash-price-1hr').val()) * BILLION\n        },\n        {\n          'class': 'speed-boost',\n          distinguisher: '24hr',\n          price: parseFloat($('#debug-RefreshPsiCash-price-24hr').val()) * BILLION\n        },\n        {\n          'class': 'speed-boost',\n          distinguisher: '7day',\n          price: parseFloat($('#debug-RefreshPsiCash-price-7day').val()) * BILLION\n        },\n        {\n          'class': 'speed-boost',\n          distinguisher: '31day',\n          price: parseFloat($('#debug-RefreshPsiCash-price-31day').val()) * BILLION\n        }\n      ] : [],\n      purchases: hasTokens && purchase ? [purchase] : null,\n      buy_psi_url: 'https://example.com/buy.psi.cash/#psicash=example',\n      account_signup_url: 'https://example.com/my.psi.cash/signup?etc',\n      account_management_url: 'https://my.psi.cash/?etc',\n    };\n  }\n\n  /**\n   * Mimic an init-done message (via C code).\n   */\n  function testInitDoneResponse() {\n    const error = $('#debug-PsiCashInitDone-error')[0].checked;\n    const recovered = $('#debug-PsiCashInitDone-recovered')[0].checked;\n    /** @type {PsiCashMessageData} */\n    const msg = {\n      type: PsiCashMessageTypeEnum.INIT_DONE,\n      id: '',\n      payload: error ? {\n        error: 'test init error message',\n        recovered: recovered\n      } : {}\n    };\n\n    setTimeout(() => HtmlCtrlInterface_PsiCashMessage(msg), 200);\n  }\n\n  /**\n   * Mimic a refresh response from the server (via C code).\n   * @param {!PsiCashCommandPurchase} command\n   */\n  function testRefreshResponse(command) {\n    const msg = makeTestRefreshMsg(command.id);\n    // Pretend the request takes a while.\n    setTimeout(() => HtmlCtrlInterface_PsiCashMessage(msg), 2000);\n  }\n\n  /**\n   * Mimic a purchase response from the server (via C code).\n   * @param {!PsiCashCommandPurchase} command\n   */\n  function testPurchaseResponse(command) {\n    var resp = $('#debug-PsiCashSpeedBoost-response').val();\n\n    /** @type {PsiCashPurchaseResponse} */\n    var msgPayload = {\n      error: null,\n      status: PsiCashServerResponseStatus.Invalid,\n      purchase: null\n    };\n\n    /** @type {PsiCashMessageData} */\n    var msg = {\n      type: PsiCashMessageTypeEnum.NEW_PURCHASE,\n      id: command.id,\n      payload: msgPayload\n    };\n\n    if (resp === 'error') {\n      msg.payload.error = 'debug error';\n    }\n    else if (PsiCashServerResponseStatus[resp] === PsiCashServerResponseStatus.Success) {\n      msg.payload.status = PsiCashServerResponseStatus.Success;\n\n      let expiry = moment().add(1, 'hour').toISOString();\n      if (command.distinguisher === '24hr') {\n        expiry = moment().add(24, 'hour').toISOString();\n      }\n      else if (command.distinguisher === '7day') {\n        expiry = moment().add(7, 'day').toISOString();\n      }\n      else if (command.distinguisher === '31day') {\n        expiry = moment().add(31, 'day').toISOString();\n      }\n\n      /** @type {PsiCashPurchase} */\n      let purchase = {\n        id: `debugpurchaseid-${randomID()}`,\n        'class': command.transactionClass, // quoting key b/c it's a keyword and old IE will complain\n        distinguisher: command.distinguisher,\n        authorization: 'myfakeauth', // not the correct format, and assuming we always want it, but that's okay for now\n        localTimeExpiry: expiry,\n        serverTimeExpiry: expiry\n      };\n\n      $('#debug-RefreshPsiCash-balance').val((g_PsiCashData.balance - command.expectedPrice) / 1e9);\n      msg.payload.refresh = makeTestRefreshPayload(purchase);\n    }\n    else {\n      msg.payload.status = PsiCashServerResponseStatus[resp];\n    }\n\n    // Pretend the request takes a while.\n    setTimeout(() => HtmlCtrlInterface_PsiCashMessage(msg), 5000);\n  }\n\n  /**\n   * Mimic an account login response from the server (via C code).\n   * @param {!PsiCashCommandPurchase} command\n   */\n  function testAccountLoginResponse(command) {\n    var resp = $('#debug-PsiCashLogin-response').val();\n\n    /** @type {PsiCashLoginResponse} */\n    var msgPayload = {\n      error: null,\n      status: PsiCashServerResponseStatus.Invalid,\n      last_tracker_merge: null,\n      refresh: null\n    };\n\n    /** @type {PsiCashMessageData} */\n    var msg = {\n      type: PsiCashMessageTypeEnum.LOGIN,\n      id: command.id,\n      payload: msgPayload\n    };\n\n    if (resp === 'error') {\n      msg.payload.error = 'debug error';\n    }\n    else if (PsiCashServerResponseStatus[resp] === PsiCashServerResponseStatus.Success) {\n      // Modify this checkbox, or else a refresh will cause us to lose state\n      $('#debug-RefreshPsiCash-isAccount')[0].checked = true;\n\n      msg.payload.status = PsiCashServerResponseStatus.Success;\n\n      msg.payload.last_tracker_merge = $('#debug-PsiCashLogin-last_tracker_merge')[0].checked;\n\n      msg.payload.refresh = makeTestRefreshPayload(undefined, true, true, 'DebugUsername');\n    }\n    else {\n      msg.payload.status = PsiCashServerResponseStatus[resp];\n    }\n\n    // Pretend the request takes a while.\n    setTimeout(() => HtmlCtrlInterface_PsiCashMessage(msg), 5000);\n  }\n\n  /**\n   * Mimic an account logout response from the server (via C code).\n   * @param {!PsiCashCommandPurchase} command\n   */\n  function testAccountLogoutResponse(command) {\n    var resp = $('#debug-PsiCashLogout-response').val();\n\n    /** @type {PsiCashLogoutResponse} */\n    var msgPayload = {\n      error: null,\n    };\n\n    /** @type {PsiCashMessageData} */\n    var msg = {\n      type: PsiCashMessageTypeEnum.LOGOUT,\n      id: command.id,\n      payload: msgPayload\n    };\n\n    if (resp === 'error') {\n      msg.payload.error = 'debug error';\n    }\n    else {\n      msg.payload.refresh = makeTestRefreshPayload(undefined, true, false, null);\n    }\n\n    // Pretend the request takes a while.\n    setTimeout(() => HtmlCtrlInterface_PsiCashMessage(msg), 5000);\n  }\n\n\n  /* INTERFACE METHODS *********************************************************/\n\n  const PSIPHON_LINK_PREFIX = 'psi:';\n\n  /* Calls from C code to JS code. */\n\n  // Add new status message.\n  function HtmlCtrlInterface_AddLog(jsonArgs) {\n    nextTick(function() {\n      // Allow object as input to assist with debugging\n      const args = _.isObject(jsonArgs) ? jsonArgs : JSON.parse(jsonArgs);\n      addLog(args);\n    });\n  }\n\n  // Add new notice. This may be interpreted and acted upon.\n  function HtmlCtrlInterface_AddNotice(jsonArgs) {\n    nextTick(function() {\n      // Allow object as input to assist with debugging\n      const args = _.isObject(jsonArgs) ? jsonArgs : JSON.parse(jsonArgs);\n      if (args.noticeType === 'UpstreamProxyError') {\n        upstreamProxyErrorNotice(args.data.message);\n      }\n      else if (args.noticeType === 'HttpProxyPortInUse' ||\n               args.noticeType === 'SocksProxyPortInUse') {\n        localProxyPortConflictNotice(args.noticeType);\n      }\n      else if (args.noticeType === 'AvailableEgressRegions') {\n        // Store the value in a cookie so that it's available at the next startup.\n        setCookie('AvailableEgressRegions', args.data.regions);\n        // Update the UI.\n        updateAvailableEgressRegions(true);\n      }\n      else if (args.noticeType === 'ServerAlert') {\n        if (args.data.reason === 'disallowed-traffic') {\n          handleDisallowedTrafficNotice();\n        }\n      }\n      else if (args.noticeType === 'TrafficRateLimits') {\n        // We are interested in the connection speed when _not_ Boosted\n        if (PsiCashStore.data.uiState !== PsiCashUIState.ACTIVE_BOOST) {\n          // Store the value in a cookie so that it's available at the next startup.\n          setCookie('BaselineRateLimit', args.data.downstreamBytesPerSecond || Number.MAX_SAFE_INTEGER);\n          // Update the UI.\n          psiCashUIUpdater();\n        }\n      }\n      else if (args.noticeType === 'SystemProxySettings::SetProxyError') {\n        showNoticeModal(\n          'notice#systemproxysettings-setproxy-error-title',\n          'notice#systemproxysettings-setproxy-error-body',\n          'error',\n          null, null, null);\n      }\n      else if (args.noticeType === 'SystemProxySettings::SetProxyWarning') {\n        const setProxyWarningTemplate = i18n.t('notice#systemproxysettings-setproxy-warning-template');\n        addLog({\n          priority: 2, // high\n          message: _.template(setProxyWarningTemplate)({data: args.data})\n        });\n      }\n      else if (args.noticeType === 'PsiphonUI::URLCopiedToClipboard') {\n        displayCornerAlert($('#alert-url-copied-to-clipboard'));\n      }\n    });\n  }\n\n  // Set the connected state.\n  // We will de-bounce the state change messages.\n  let g_timeoutSetState = null;\n  function HtmlCtrlInterface_SetState(jsonArgs) {\n    // Clear any queued state changes.\n    if (g_timeoutSetState !== null) {\n      clearTimeout(g_timeoutSetState);\n      g_timeoutSetState = null;\n    }\n\n    g_timeoutSetState = setTimeout(function() {\n      g_timeoutSetState = null;\n\n      // Allow object as input to assist with debugging\n      var args = _.isObject(jsonArgs) ? jsonArgs : JSON.parse(jsonArgs);\n      g_lastState = args.state;\n      $window.trigger(CONNECTED_STATE_CHANGE_EVENT);\n    }, 100);\n  }\n\n  // Refresh the current settings values.\n  function HtmlCtrlInterface_RefreshSettings(jsonArgs) {\n    nextTick(function() {\n      var args = JSON.parse(jsonArgs);\n      refreshSettings(args.settings, true);\n\n      if (args.success){\n        if (args.reconnectRequired) {\n          // backend is reconnecting to apply the settings\n          displayCornerAlert($('#settings-apply-alert'));\n        }\n        else {\n          displayCornerAlert($('#settings-save-alert'));\n        }\n      }\n      // else an error occurred when saving settings... TODO: tell user?\n    });\n  }\n\n  // Indicate a DPI-based scaling change.\n  function HtmlCtrlInterface_UpdateDpiScaling(jsonArgs) {\n    DEBUG_LOG('HtmlCtrlInterface_UpdateDpiScaling called');\n\n    // Allow object as input to assist with debugging\n    var args = _.isObject(jsonArgs) ? jsonArgs : JSON.parse(jsonArgs);\n    nextTick(function() {\n      updateDpiScaling(args.dpiScaling);\n    });\n  }\n\n\n  /**\n   * Called from C code when something PsiCash-related occurs, such as a data refresh or\n   * purchase completion.\n   * @param {PsiCashMessageData|string} jsonArgs\n   */\n  function HtmlCtrlInterface_PsiCashMessage(jsonArgs) {\n    nextTick(function() {\n      DEBUG_LOG('HtmlCtrlInterface_PsiCashMessage', jsonArgs);\n\n      let args;\n      try {\n        // Allow object as input to assist with debugging\n        args = _.isObject(jsonArgs) ? jsonArgs : JSON.parse(jsonArgs);\n      }\n      catch(e) {\n        HtmlCtrlInterface_Log('HtmlCtrlInterface_PsiCashMessage: JSON parse failed: ' + e);\n        return;\n      }\n\n      switch (args.type) {\n        case PsiCashMessageTypeEnum.REFRESH:\n          // Payload is PsiCashRefreshData\n          $window.trigger(PsiCashEventTypeEnum.REFRESH, args.payload);\n          break;\n\n        case PsiCashMessageTypeEnum.NEW_PURCHASE:\n          // Payload is PsiCashPurchaseResponse\n          // Nothing special to be done; the promise will be resolved below\n          break;\n\n        case PsiCashMessageTypeEnum.INIT_DONE:\n          // Payload is PsiCashInitDoneData\n          $window.trigger(PsiCashEventTypeEnum.INIT_DONE, args.payload);\n          break;\n\n        case PsiCashMessageTypeEnum.LOGIN:\n          // Payload is PsiCashLoginResponse\n          // Nothing special to be done; the promise will be resolved below\n          break;\n\n        case PsiCashMessageTypeEnum.LOGOUT:\n          // Payload is PsiCashLogoutResponse\n          // Nothing special to be done; the promise will be resolved below\n          break;\n      }\n\n      // Resolve any promise that's awaiting this message/response.\n      if (args.id && !_.isUndefined(g_PsiCashCommandIDToResolver[args.id])) {\n        // Trigger a unique event so that the waiting promise can be resolved.\n        g_PsiCashCommandIDToResolver[args.id].call(null, args.payload);\n        delete g_PsiCashCommandIDToResolver[args.id];\n      }\n    });\n  }\n\n  /* Calls from JS code to C code. */\n\n  // Let the C code know that the UI is ready.\n  function HtmlCtrlInterface_AppReady() {\n    nextTick(function() {\n      var appURL = PSIPHON_LINK_PREFIX + 'ready';\n      if (IS_BROWSER) {\n        console.log(appURL);\n      }\n      else {\n        window.location = appURL;\n      }\n\n      $window.trigger(UI_READY_EVENT);\n    });\n  }\n\n  // Give the C code a string table entry in the appropriate language.\n  // `locale` is the locale for this string table.\n  // The `stringtable` can and should be a full set of key:string mappings, but\n  // the strings will be sent to the C code one at a time, to prevent URL size\n  // overflow.\n  function HtmlCtrlInterface_AddStringTableItem(locale, stringtable) {\n    for (var key in stringtable) {\n      if (!stringtable.hasOwnProperty(key)) {\n        continue;\n      }\n\n      var item = {\n        locale: locale,\n        key: key,\n        string: stringtable[key]\n      };\n      sendStringTableItem(item);\n    }\n\n    function sendStringTableItem(itemObj) {\n      nextTick(function() {\n        var appURL = PSIPHON_LINK_PREFIX + 'stringtable?' + encodeURIComponent(JSON.stringify(itemObj));\n        if (IS_BROWSER) {\n          console.log(decodeURIComponent(appURL));\n        }\n        else {\n          window.location = appURL;\n        }\n      });\n    }\n  }\n\n  /**\n   * Add a log entry to the log pane.\n   */\n  function HtmlCtrlInterface_Log() {\n    const msg = Array.prototype.slice.call(arguments).join(' ');\n    nextTick(function() {\n      var appURL = PSIPHON_LINK_PREFIX + 'log?' + encodeURIComponent(msg);\n      if (IS_BROWSER) {\n        console.log(decodeURIComponent(appURL));\n      }\n      else {\n        window.location = appURL;\n      }\n    });\n  }\n\n  // Connection should start.\n  function HtmlCtrlInterface_StartTunnel() {\n    // Prevent duplicate state change attempts\n    if (g_lastState === 'starting' || g_lastState === 'connected') {\n      return;\n    }\n    nextTick(function() {\n      var appURL = PSIPHON_LINK_PREFIX + 'start';\n      if (IS_BROWSER) {\n        console.log(appURL);\n      }\n      else {\n        window.location = appURL;\n      }\n    });\n  }\n\n  // Connection should stop.\n  function HtmlCtrlInterface_StopTunnel() {\n    // Prevent duplicate state change attempts\n    if (g_lastState === 'stopping' || g_lastState === 'disconnected') {\n      return;\n    }\n    nextTick(function() {\n      var appURL = PSIPHON_LINK_PREFIX + 'stop';\n      if (IS_BROWSER) {\n        console.log(appURL);\n      }\n      else {\n        window.location = appURL;\n      }\n    });\n  }\n\n  // The tunnel should be reconnected (if connected or connecting).\n  function HtmlCtrlInterface_ReconnectTunnel(suppressHomePage) {\n    var appURL = PSIPHON_LINK_PREFIX + 'reconnect?suppress=' + (suppressHomePage ? '1' : '0');\n\n    // Prevent duplicate state change attempts\n    if (g_lastState === 'stopping' || g_lastState === 'disconnected') {\n      return;\n    }\n    nextTick(function() {\n      if (IS_BROWSER) {\n        alert('Tunnel reconnected requested');\n        console.log(appURL);\n      }\n      else {\n        window.location = appURL;\n      }\n    });\n  }\n\n  // Settings should be saved.\n  function HtmlCtrlInterface_SaveSettings(settingsJSON) {\n    nextTick(function() {\n      var appURL = PSIPHON_LINK_PREFIX + 'savesettings?' + encodeURIComponent(settingsJSON);\n      if (IS_BROWSER) {\n        console.log(decodeURIComponent(appURL));\n\n        // DEBUG: Make it appear to behave like a real client\n        _.delay(HtmlCtrlInterface_RefreshSettings, 100, JSON.stringify({\n          settings: JSON.parse(settingsJSON),\n          success: true,\n          reconnectRequired: g_lastState === 'connected' || g_lastState === 'starting'\n        }));\n      }\n      else {\n        window.location = appURL;\n      }\n    });\n  }\n\n  // Feedback should be sent.\n  function HtmlCtrlInterface_SendFeedback(feedbackJSON) {\n    nextTick(function() {\n      var appURL = PSIPHON_LINK_PREFIX + 'sendfeedback?' + encodeURIComponent(feedbackJSON);\n      if (IS_BROWSER) {\n        console.log(decodeURIComponent(appURL));\n      }\n      else {\n        window.location = appURL;\n      }\n    });\n  }\n\n  // Cookies (i.e., UI settings) should be saved.\n  function HtmlCtrlInterface_SetCookies(cookiesJSON) {\n    nextTick(function() {\n      var appURL = PSIPHON_LINK_PREFIX + 'setcookies?' + encodeURIComponent(cookiesJSON);\n      if (IS_BROWSER) {\n        console.log(decodeURIComponent(appURL));\n      }\n      else {\n        window.location = appURL;\n      }\n    });\n  }\n\n  // Banner was clicked.\n  function HtmlCtrlInterface_BannerClick() {\n    nextTick(function() {\n      var appURL = PSIPHON_LINK_PREFIX + 'bannerclick';\n      if (IS_BROWSER) {\n        console.log(decodeURIComponent(appURL));\n        alert('Call from JS to C to launch banner URL');\n      }\n      else {\n        window.location = appURL;\n      }\n    });\n  }\n\n  /**\n   * Called when a \"disallowed traffic\" server alert is encountered. The C code will take\n   * steps to make the window visible.\n   */\n  function HtmlCtrlInterface_DisallowedTraffic() {\n    nextTick(function() {\n      var appURL = PSIPHON_LINK_PREFIX + 'disallowedtraffic';\n      if (IS_BROWSER) {\n        console.log(decodeURIComponent(appURL));\n        alert('Call from JS to C in response to disallowed traffic');\n      }\n      else {\n        window.location = appURL;\n      }\n    });\n  }\n\n  /**\n   * Used to communicate Promise resolvers between HtmlCtrlInterface_PsiCashCommand (called\n   * locally) and HtmlCtrlInterface_PsiCashMessage (called from C code).\n   * NOTE: Ideally this would be a map, but our restrictive environment doesn't support them.\n   * @type {Map<string, function>}\n   */\n  let g_PsiCashCommandIDToResolver = {};\n\n  /**\n   * A PsiCash \"command\" should be executed, like purchasing speed boost or refreshing state.\n   * Returns a promise that will be resolved when the command completes.\n   * @param {!PsiCashCommandBase} command\n   * @returns {Promise}\n   */\n  function HtmlCtrlInterface_PsiCashCommand(command) {\n    let commandJSON = JSON.stringify(command);\n\n    let promise = new Promise((resolve) => {\n      g_PsiCashCommandIDToResolver[command.id] = resolve;\n\n      nextTick(function() {\n        let appURL = PSIPHON_LINK_PREFIX + 'psicash?' + encodeURIComponent(commandJSON);\n\n        if (IS_BROWSER) {\n          console.log(decodeURIComponent(appURL));\n          const commandToTestResponse = {\n            [PsiCashCommandEnum.REFRESH]: testRefreshResponse,\n            [PsiCashCommandEnum.PURCHASE]: testPurchaseResponse,\n            [PsiCashCommandEnum.LOGIN]: testAccountLoginResponse,\n            [PsiCashCommandEnum.LOGOUT]: testAccountLogoutResponse\n          };\n          commandToTestResponse[command.command](command);\n        }\n        else {\n          window.location = appURL;\n        }\n      });\n    });\n\n    return promise;\n  }\n\n  /* EXPORTS */\n\n  // The C interface code is unable to access functions that are members of objects,\n  // so we'll need to directly expose our exports.\n\n  window.HtmlCtrlInterface_AddLog = HtmlCtrlInterface_AddLog; // @ts-ignore\n  window.HtmlCtrlInterface_SetState = HtmlCtrlInterface_SetState;\n  window.HtmlCtrlInterface_AddNotice = HtmlCtrlInterface_AddNotice;\n  window.HtmlCtrlInterface_RefreshSettings = HtmlCtrlInterface_RefreshSettings;\n  window.HtmlCtrlInterface_UpdateDpiScaling = HtmlCtrlInterface_UpdateDpiScaling;\n  window.HtmlCtrlInterface_PsiCashMessage = HtmlCtrlInterface_PsiCashMessage;\n\n  })(window);\n"],"file":"app.js"}